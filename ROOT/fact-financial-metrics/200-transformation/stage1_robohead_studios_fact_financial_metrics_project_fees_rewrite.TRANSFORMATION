{"job":{"components":{"2004672":{"id":2004672,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-208,"y":624,"width":32,"height":32,"inputConnectorIDs":[2004827],"outputConnectorIDs":[2004706],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get invoices per project_id per fiscal_month"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"--Get invoice details per month and other attributes\nselect\t\n    \tmax(project_fee_history_id)\t\t\t\t\t\t\tas\tproject_fee_history_id\n    ,\tproject_id\n    ,\tproject_fee_id\n    ,   revenue_status\n    , \tbilling_type_id\n    ,\tmax(project_fee_id_count)\t\t\t\t\t\t\t\t\t\tas\tproject_fee_id_count\n    ,\tclient_id\n    ,\torder_invoice_id\n    ,\tinvoice_number\n    ,\tmax(invoice_date)\tas\tinvoice_date\n    ,\tcase when order_invoice_id is not null then fiscal_month else null end\tas\tinvoice_month\n    ,\tfiscal_month\n    ,\tfiscal_quarter\nfrom\t$T{Join future dd attributes}\ngroup by project_id, project_fee_id, invoice_number, revenue_status, billing_type_id, client_id, order_invoice_id, fiscal_month, fiscal_quarter\norder\tby\tproject_id, project_fee_id, fiscal_month, fiscal_quarter"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004673":{"id":2004673,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":64,"y":624,"width":32,"height":32,"inputConnectorIDs":[2004830],"outputConnectorIDs":[2004774],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"calc monthly & weekly & excess amounts"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with cte_base_open_qtr\nas (\n\tselect\tproject_fee_history_id\n\t\t,\tproject_id\n\t\t,\tproject_fee_id\n\t\t,\tclient_id\n\t\t,\trevenue_status\n\t\t,\tbilling_type_id\n\t\t,\torder_invoice_id\n\t\t,\tcase when invoice_month = fiscal_month then invoice_number else null end as invoice_number\n\t\t,\tcase when invoice_month = fiscal_month then invoice_date else null end invoice_date\n\t\t,\tinvoice_month\n\t\t,\tfrequency\n\t\t,\trecurring\n\t\t,\tfee_amount\n\t\t,\ttotal_qtr_revenue\n\t\t,\tweekly_revenue_amount\n\t\t,\tcase when order_invoice_id is null then 0 else revenue_amount end as revenue_amount\n\t\t,\tcase when order_invoice_id is null then \n\t  \t\t\t\tcase when nvl(estimated_wip_revenue, 0) = 0 then revenue_amount else estimated_wip_revenue end\n\t  \t\telse 0 end as estimated_wip_revenue\n\t\t,\tfirst_fmonth\n\t\t,\ttotal_weeks\n\t\t,\tmonth_rank\n\t\t,\tweeks_per_month\n\t\t,\tfiscal_month\n\t\t,\tfiscal_quarter\n\t\t,\tweeks_per_qtr\n\t\t,\tprev_weeks_qtr\n\tfrom\t$T{assign wes}\n) \n\n, cte_fee_excess_calc_1\nas (\n\tselect\t*\n\t  \t,\tweekly_revenue_amount * weeks_per_month\tas\tcalc_monthly_revenue\n\t  \t,\tcase\n\t  \t\t\twhen abs(fee_amount) > (abs(weekly_revenue_amount) * weeks_per_month)\n\t  \t\t\t\tthen fee_amount - (weekly_revenue_amount * weeks_per_month)\n\t  \t\telse 0 \n\t  \t\tend as fee_excess\n\tfrom\tcte_base_open_qtr\n)\n\n, cte_fee_excess_calc_2\nas (\n\tselect\t*\n  \t\t,\tfee_amount + coalesce(lag(fee_excess, 1) over (partition by project_fee_id,fiscal_quarter order by month_rank),0) - calc_monthly_revenue as calc_fee_excess\n\tfrom\tcte_fee_excess_calc_1\n\n)\n\n, cte_fee_overflow\nas (\n\tselect\t*\n  \t\t,\tcase\n  \t\t\t\twhen abs(fee_amount + coalesce(lag(calc_fee_excess, 1) over (partition by project_fee_id,fiscal_quarter order by month_rank),0) - calc_monthly_revenue) > 1\n  \t\t\t\t\tthen fee_amount + coalesce(lag(calc_fee_excess, 1) over (partition by project_fee_id,fiscal_quarter order by month_rank),0) - calc_monthly_revenue\n  \t\t\t\telse 0\n  \t\t\tend as fee_excess_amount\n\tfrom\tcte_fee_excess_calc_2\n\n)\n\nselect\tproject_fee_history_id\n    ,\tproject_id\n\t,\tproject_fee_id\n\t,\tclient_id\n\t,\tfiscal_quarter\n\t,\tfee_amount\n\t,\tinvoice_number\n\t,\tinvoice_date\n\t,\tinvoice_month\n\t,\trevenue_amount\n\t,\testimated_wip_revenue\n\t,   total_qtr_revenue\n\t,\tweekly_revenue_amount\n\t,\tfiscal_month\n\t,\tmonth_rank\n\t,\tweeks_per_month\n\t,\tweeks_per_qtr\n\t,\tprev_weeks_qtr\n\t,\tfrequency\n\t,\trecurring\n\t,\torder_invoice_id\n\t,\trevenue_status\n\t,\tbilling_type_id\n\t,\tfirst_fmonth\n\t,\ttotal_weeks\n    ,\tcalc_monthly_revenue\n    ,\tfee_excess_amount\nfrom\tcte_fee_overflow\norder\tby\tmonth_rank\n"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004674":{"id":2004674,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":208,"y":624,"width":32,"height":32,"inputConnectorIDs":[2004760,2004774],"outputConnectorIDs":[2004754],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"distribute revenue for open"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"calc monthly & weekly & excess amounts"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Distinct WES / month"},"2":{"slot":2,"type":"STRING","value":"qtr"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"fiscal_quarter\"=\"qtr\".\"fiscal_quarter\"\nand\n\"rrspfh\".\"fiscal_month\"=\"qtr\".\"fiscal_month\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_qtr"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"billing_type_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_month"},"2":{"slot":2,"type":"STRING","value":"invoice_month"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_qtr_revenue"},"2":{"slot":2,"type":"STRING","value":"total_qtr_revenue"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weekly_revenue_amount"},"2":{"slot":2,"type":"STRING","value":"weekly_revenue_amount"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.first_fmonth"},"2":{"slot":2,"type":"STRING","value":"first_fmonth"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weeks_per_month"},"2":{"slot":2,"type":"STRING","value":"weeks_per_month"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weeks_per_qtr"},"2":{"slot":2,"type":"STRING","value":"weeks_per_qtr"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.prev_weeks_qtr"},"2":{"slot":2,"type":"STRING","value":"prev_weeks_qtr"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_excess_amount"},"2":{"slot":2,"type":"STRING","value":"fee_excess_amount"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004675":{"id":2004675,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":-752,"y":560,"width":32,"height":32,"inputConnectorIDs":[2004763,2004765,2004782],"outputConnectorIDs":[2004768],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join dd attr"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calculate revenue & wip"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get wes count per month"},"2":{"slot":2,"type":"STRING","value":"mnth"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Calc closing date"},"2":{"slot":2,"type":"STRING","value":"qtr"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"left(\"bill_date\",7)::varchar = \"mnth\".\"fiscal_month\""},"2":{"slot":2,"type":"STRING","value":"rrsph_Left_mnth"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"\"mnth\".\"fiscal_quarter\"=\"qtr\".\"fiscal_quarter\""},"2":{"slot":2,"type":"STRING","value":"rrsph_Left_qtr"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.project_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.project_fee_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"billing_type_id"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.max_week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"last_wes"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.closing_date"},"2":{"slot":2,"type":"STRING","value":"closing_date"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.is_qtr_closed"},"2":{"slot":2,"type":"STRING","value":"is_qtr_closed"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.count_distinct_week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"no_of_weeks"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"mnth.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"mnth.count_distinct_week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"no_of_wks_month"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004676":{"id":2004676,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-1424,"y":512,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004776],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_fee_history"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_fee_history"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"project_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"client_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"amount"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"status_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"invoice_id"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"invoice_number"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"bill_date"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"created_on"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004677":{"id":2004677,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1701703136,"x":-368,"y":560,"width":32,"height":32,"inputConnectorIDs":[2004715],"outputConnectorIDs":[2004759,2004782],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get wes count per month"}}}},"visible":true},"2":{"slot":2,"name":"Groupings","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}}},"visible":true},"3":{"slot":3,"name":"Aggregations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"Count Distinct"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004678":{"id":2004678,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":816,"y":848,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004705],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_source_system"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_source_system"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"source_system_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"source_system_name"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004679":{"id":2004679,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-1232,"y":592,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004753],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_fee"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_fee"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"frequency"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"recurring"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004680":{"id":2004680,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":880,"y":832,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004790],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_currency"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_currency"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"currency_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"currency_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"exchange_rate_id"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004681":{"id":2004681,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":752,"y":832,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004825],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"client_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"current_record_ind"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"source_system_sk"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"source_client_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"client_currency_sk"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"market_id"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004682":{"id":2004682,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-1232,"y":832,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004831],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_cloudwall_order_invoice"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_cloudwall_order_invoice"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"order_invoice_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"order_invoice_date"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"market_id"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004683":{"id":2004683,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":864,"y":640,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004751],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_project"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_project"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"project_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"current_record_ind"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"isdeleted"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"source_system_sk"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"source_system"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"engagement_id"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004684":{"id":2004684,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":-912,"y":560,"width":32,"height":32,"inputConnectorIDs":[2004784],"outputConnectorIDs":[2004765],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calculate revenue & wip"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"case when \"order_invoice_id\" is not null then \"amount\" else 0 end"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"case when \"order_invoice_id\" is null then \"amount\" else 0 end"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"\"amount\""},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"case when \"invoice_number\" = 'null' then null else \"invoice_number\" end"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004685":{"id":2004685,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":720,"y":704,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004758,2004772],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"date_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"calendar_date"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004686":{"id":2004686,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-1232,"y":672,"width":32,"height":32,"inputConnectorIDs":[2004787],"outputConnectorIDs":[2004826],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"billing_type_id"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"billing_type_id"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"107"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004687":{"id":2004687,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":609793074,"x":-752,"y":704,"width":32,"height":32,"inputConnectorIDs":[2004768],"outputConnectorIDs":[2004713,2004829],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"count fees per qtr"}}}},"visible":true},"2":{"slot":2,"name":"Include input columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Partition Data","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"project_fee_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}}},"visible":true},"4":{"slot":4,"name":"Ordering within partitions","elements":{},"visible":true},"5":{"slot":5,"name":"Lower Bound","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Upper Bound","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"7":{"slot":7,"name":"Lower Bound Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":false},"8":{"slot":8,"name":"Upper Bound Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":false},"9":{"slot":9,"name":"Functions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Count"},"2":{"slot":2,"type":"STRING","value":"project_fee_id"},"3":{"slot":3,"type":"STRING","value":"project_fee_id_count"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004688":{"id":2004688,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-1424,"y":752,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004766],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_pivot"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_pivot"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"retainers_billed_by_fee"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004689":{"id":2004689,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-208,"y":704,"width":32,"height":32,"inputConnectorIDs":[2004794],"outputConnectorIDs":[2004710],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get fee unit by project"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select\t\n    \tproject_id\n    ,\tproject_fee_id\n    ,\tmax(project_fee_id_count)\tas\tproject_fee_id_count\n    ,\tmax(client_id)\tas\tclient_id\n    ,\tmin(month_rank) as\tfirst_fmonth\n    ,\tmax(weeks_per_month)\tas\tweeks_per_month\n    ,\tmax(weeks_per_qtr)\tas\tweeks_per_qtr\n    ,\tmin(prev_weeks_qtr)\tas\tprev_weeks_qtr\n    ,\tcase when min(month_rank) = 1 then max(weeks_per_qtr)\n    \t\t when min(month_rank) = 2 then max(weeks_per_qtr - prev_weeks_qtr)\n        else max(weeks_per_month) end as\ttotal_weeks\n    ,\tmax(fee_amount)\tas\tfee_amount\n    ,\tmax(revenue_amount)\tas\trevenue_amount\n    ,\tmax(revenue_amount) * (case when min(month_rank) = 1 then 3 when min(month_rank) = 2 then 2 else 1 end) \tas\ttotal_qtr_revenue\n    ,\tmax(revenue_amount) * (case when min(month_rank) = 1 then 3 when min(month_rank) = 2 then 2 else 1 end)\t\n    \t/\t\n        (case when min(month_rank) = 1 then max(weeks_per_qtr)\n    \t\t when min(month_rank) = 2 then max(weeks_per_qtr - prev_weeks_qtr)\n        else max(weeks_per_month) end)\tas\tweekly_revenue_amount\n    ,\tmax(estimated_wip_revenue)\tas\testimated_wip_revenue\n    ,\tfiscal_quarter\nfrom\t$T{Join future dd attributes}\ngroup by project_id, project_fee_id, fiscal_quarter\norder\tby\tproject_id, project_fee_id, fiscal_quarter"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004690":{"id":2004690,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-912,"y":672,"width":32,"height":32,"inputConnectorIDs":[2004761],"outputConnectorIDs":[2004784],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Monthly Recurring Fees"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"frequency"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"546"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"recurring"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"1"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004691":{"id":2004691,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-1232,"y":752,"width":32,"height":32,"inputConnectorIDs":[2004766],"outputConnectorIDs":[2004764],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"retainers_billed_by_fee"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"retainers_billed_by_fee"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Null or blank"},"4":{"slot":4,"type":"STRING","value":"true"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"retainers_billed_by_fee"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"No"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"OR"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004692":{"id":2004692,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-256,"y":432,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004823],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_task"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_task"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004693":{"id":2004693,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-1841822228,"x":592,"y":720,"width":32,"height":32,"inputConnectorIDs":[2004755,2004769,2004775,2004780],"outputConnectorIDs":[2004711],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"unite project_fee_history"}}}},"visible":true},"2":{"slot":2,"name":"Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"All Columns"}}}},"visible":true},"3":{"slot":3,"name":"Cast Types","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"4":{"slot":4,"name":"Add Source Component Column","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Remove duplicates","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004701":{"id":2004701,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":609793074,"x":-768,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004773],"outputConnectorIDs":[2004792],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get fee amount percentages"}}}},"visible":true},"2":{"slot":2,"name":"Include input columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Partition Data","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"}}}},"visible":true},"4":{"slot":4,"name":"Ordering within partitions","elements":{},"visible":true},"5":{"slot":5,"name":"Lower Bound","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Upper Bound","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"7":{"slot":7,"name":"Lower Bound Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":false},"8":{"slot":8,"name":"Upper Bound Offset","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"INTEGER","value":""}}}},"visible":false},"9":{"slot":9,"name":"Functions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Sum"},"2":{"slot":2,"type":"STRING","value":"fee_estimated_wip_amount"},"3":{"slot":3,"type":"STRING","value":"total_fee_estimated_wip_amount"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Sum"},"2":{"slot":2,"type":"STRING","value":"amount"},"3":{"slot":3,"type":"STRING","value":"total_fees_amount"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"Sum"},"2":{"slot":2,"type":"STRING","value":"fee_invoiced_amount"},"3":{"slot":3,"type":"STRING","value":"total_fee_invoiced_amount"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004702":{"id":2004702,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-368,"y":176,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004762],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_timeslip"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_timeslip"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"user_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"task_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip_date"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"hours"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"bill_rate"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_id"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"pay_rate"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004703":{"id":2004703,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":768,"y":640,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004822],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_market"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_market"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"market_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"market_id"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004714":{"id":2004714,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-1232,"y":512,"width":32,"height":32,"inputConnectorIDs":[2004776],"outputConnectorIDs":[2004828],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Exclude state = 2"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"state"},"2":{"slot":2,"type":"STRING","value":"Not"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"2"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004716":{"id":2004716,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1056,"y":832,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004712],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_fee_history STATE"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_fee_history"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004717":{"id":2004717,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-1424,"y":672,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004787],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"billing_type_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"budgeted_revenue"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"actual_revenue"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004718":{"id":2004718,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1701703136,"x":208,"y":416,"width":32,"height":32,"inputConnectorIDs":[2004788],"outputConnectorIDs":[2004778],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Aggr timeslip amount per project"}}}},"visible":true},"2":{"slot":2,"name":"Groupings","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"}}}},"visible":true},"3":{"slot":3,"name":"Aggregations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip_amount"},"2":{"slot":2,"type":"STRING","value":"Sum"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004719":{"id":2004719,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":400,"y":624,"width":32,"height":32,"inputConnectorIDs":[2004754],"outputConnectorIDs":[2004755],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"distribute open qtr invoice + wip revenue"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with cte_calculate_new_lines\nas (\n\tselect\tbase.project_fee_history_id\n\t\t\t,\tbase.project_id\n\t\t\t,\tbase.project_fee_id\n\t\t\t,\tbase.client_id\n\t\t\t,\tbase.order_invoice_id\n\t\t\t,\tbase.invoice_number\n\t\t\t,\tbase.invoice_date\n\t  \t\t,\tbase.invoice_month\n\t\t\t,\tbase.fee_amount\n\t\t\t,\tbase.total_qtr_revenue\n\t\t\t,\tbase.weekly_revenue_amount\n\t\t\t,\tbase.revenue_amount\n\t\t\t,\tbase.estimated_wip_revenue\n\t\t\t,\tbase.fee_excess_amount\n\t\t  \t,\tbase.revenue_status\n\t\t\t,\tbase.billing_type_id\n\t\t  \t,\tlead(base.bill_date::date, 1) over (partition by base.project_fee_id, base.fiscal_quarter order by base.bill_date::date)\tas bill_date\n\t\t  \t,\tlead(base.fiscal_month, 1) over (partition by base.project_fee_id, base.fiscal_quarter order by base.bill_date::date) as fiscal_month\n\t\t  \t,\tlead(base.fiscal_quarter, 1) over (partition by base.project_fee_id, base.fiscal_quarter order by base.bill_date::date) as fiscal_quarter\n\t\t\t,\tbase.frequency\n\t\t\t,\tbase.recurring\n\t\t    ,\trank() over (partition by base.project_fee_history_id, base.project_fee_id,\tbase.fiscal_month, base.fiscal_quarter order by base.bill_date desc) as rank_num\n\t  \t\t,\tbase.first_fmonth\n\t\t\t,\tbase.weeks_per_month\n\t\t\t,\tbase.weeks_per_qtr\n\t\t\t,\tbase.prev_weeks_qtr\n\tfrom $T{distribute revenue for open} base\n\t\tleft join reporting.dim_date rdd\n  \t\t\ton\tdateadd('weeks', 1, base.bill_date::date) = rdd.calendar_date\n)\n\n, cte_get_overflows\nas (\n\tselect\tproject_fee_history_id\n\t\t,\tproject_id\n\t\t,\tproject_fee_id\n\t\t,\tclient_id\n\t\t,\torder_invoice_id\n\t\t,\tinvoice_number\n\t\t,\tinvoice_date\n\t\t,\tfee_amount\n\t\t,\ttotal_qtr_revenue\n\t\t,\tweekly_revenue_amount\n\t\t,\tcase when order_invoice_id is not null then fee_excess_amount else 0 end as revenue_amount\n\t\t,\tcase when order_invoice_id is null \t then fee_excess_amount else 0 end as estimated_wip_revenue\n\t  \t,\trevenue_status\n\t\t,\tbilling_type_id\n\t  \t,\tbill_date\n\t  \t,\tfiscal_month\n\t  \t,\tfiscal_quarter\n\t  \t,\tfrequency\n\t\t,\trecurring\n\t  \t,\tfirst_fmonth\n\t\t,\tweeks_per_month\n\t\t,\tweeks_per_qtr\n\t\t,\tprev_weeks_qtr\n\t  from\tcte_calculate_new_lines\n\t  where\trank_num = 1 and bill_date is not null and project_fee_history_id is not null\n\n)\n\n, cte_union\nas (\n\tselect\tproject_fee_history_id\n\t\t,\tproject_id\n\t\t,\tproject_fee_id\n\t\t,\tclient_id\n\t\t,\torder_invoice_id\n\t\t,\tinvoice_number\n\t\t,\tinvoice_date\n\t\t,\tfee_amount\n\t\t,\ttotal_qtr_revenue\n  \t\t,\tweekly_revenue_amount\n\t\t,\trevenue_amount\n\t\t,\testimated_wip_revenue\n\t  \t,\trevenue_status\n\t\t,\tbilling_type_id\n\t  \t,\tbill_date\n\t  \t,\tfiscal_month\n\t  \t,\tfiscal_quarter\n\t  \t,\tfrequency\n\t\t,\trecurring\n\t  \t,\tfirst_fmonth\n\t\t,\tweeks_per_month\n\t\t,\tweeks_per_qtr\n\t\t,\tprev_weeks_qtr\n\t  \t,\ttrue as is_overflow\n\t  from\tcte_get_overflows\n\tunion\tall\n\tselect\tproject_fee_history_id\n\t\t,\tproject_id\n\t\t,\tproject_fee_id\n\t\t,\tclient_id\n\t\t,\torder_invoice_id\n\t\t,\tinvoice_number\n\t\t,\tinvoice_date\n\t\t,\tfee_amount\n\t\t,\ttotal_qtr_revenue\n\t\t,\tweekly_revenue_amount\n\t    ,\tcase when order_invoice_id is not null then weekly_revenue_amount else 0 end as revenue_amount\n\t    ,\tcase when order_invoice_id is null then weekly_revenue_amount else 0 end as estimated_wip_revenue\n\t\t,\trevenue_status\n\t\t,\tbilling_type_id\n\t  \t,\tbill_date\n\t  \t,\tfiscal_month\n\t  \t,\tfiscal_quarter\n\t  \t,\tfrequency\n\t\t,\trecurring\n\t  \t,\tfirst_fmonth\n\t\t,\tweeks_per_month\n\t\t,\tweeks_per_qtr\n\t\t,\tprev_weeks_qtr\n\t  \t,\tfalse as is_overflow\t\n\tfrom\t$T{distribute revenue for open}\n\torder\tby\tbill_date,project_fee_history_id\n)\n\n, cte_flag_overrides\nas (\n\tselect\t*\n\t\t,\tcase when max(case when is_overflow = true then 1 else 0 end) over (partition\tby\tproject_fee_id,\tbill_date, fiscal_month) > 0 then true else false end\tas\tis_override\n\tfrom\tcte_union\n\torder\tby\tbill_date,project_fee_history_id\n)\n\n\n, cte_windowcalc_rows_with_overflows\nas (\n\tselect\tproject_fee_history_id\n\t\t,\tproject_id\n\t\t,\tproject_fee_id\n\t\t,\tclient_id\n\t\t,\torder_invoice_id\n\t\t,\tinvoice_number\n\t\t,\tinvoice_date\n\t\t,\tfee_amount\n\t\t,\ttotal_qtr_revenue\n\t\t,\tweekly_revenue_amount\n\t    ,\tcase\n\t\t\t\twhen is_overflow = false and is_override = true and revenue_amount <> 0\n\t  \t\t\t\tthen revenue_amount - (lag(revenue_amount)over(partition by project_fee_id,bill_date order by project_fee_history_id) + lag(estimated_wip_revenue)over(partition by project_fee_id,bill_date order by project_fee_history_id))\n\t  \t\t\telse revenue_amount\n\t  \t\tend as revenue_amount\n\t    ,\tcase\n\t\t\t\twhen is_overflow = false and is_override = true and estimated_wip_revenue <> 0\n\t  \t\t\t\tthen estimated_wip_revenue - (lag(revenue_amount)over(partition by project_fee_id,bill_date order by project_fee_history_id) + lag(estimated_wip_revenue)over(partition by project_fee_id,bill_date order by project_fee_history_id))\n\t  \t\t\telse estimated_wip_revenue\n\t  \t\tend as estimated_wip_revenue\n\t    ,\trevenue_status\n\t\t,\tbilling_type_id\n\t  \t,\tbill_date\n\t  \t,\tfiscal_month\n\t  \t,\tfiscal_quarter\n\t  \t,\tfirst_fmonth\n\t\t,\tweeks_per_month\n\t\t,\tweeks_per_qtr\n\t\t,\tprev_weeks_qtr\n\t  \t,\tfrequency\n\t\t,\trecurring\n\t  \t,\tis_overflow\n\t  \t,\tis_override\n\tfrom\tcte_flag_overrides\n\torder\tby\tbill_date,project_fee_history_id\n)\n\nselect\tproject_fee_history_id\n\t,\tproject_id\n\t,\tproject_fee_id\n\t,\tclient_id\n\t,\torder_invoice_id\n\t,\tinvoice_number\n\t,\tinvoice_date\n\t,\tfee_amount\n\t,\ttotal_qtr_revenue\n    ,\tweekly_revenue_amount\n\t,\trevenue_amount\n\t,\testimated_wip_revenue\n    ,\trevenue_status\n\t,\tbilling_type_id\n  \t,\tbill_date\n  \t,\tfiscal_month\n  \t,\tfiscal_quarter\n    ,\tfirst_fmonth\n\t,\tweeks_per_month\n\t,\tweeks_per_qtr\n\t,\tprev_weeks_qtr\n  \t,\tfrequency\n\t,\trecurring\nfrom\tcte_windowcalc_rows_with_overflows\norder\tby\tbill_date,project_fee_history_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004720":{"id":2004720,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":400,"y":784,"width":32,"height":32,"inputConnectorIDs":[2004793],"outputConnectorIDs":[2004775],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"distribute closed qtr invoice + wip revenue"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with cte_calc_overflows\nas (\n\tselect\tbase.project_fee_history_id\n\t\t,\tbase.project_id\n\t\t,\tbase.project_fee_id\n\t\t,\tbase.client_id\n\t\t,\tbase.order_invoice_id\n\t\t,\tbase.invoice_number\n\t\t,\tbase.invoice_date\n\t\t,\tbase.fee_amount\n\t\t,\tbase.total_qtr_revenue\n\t\t,\tbase.weekly_revenue_amount\n\t\t,\tbase.revenue_amount\n\t\t,\tbase.estimated_wip_revenue\n\t  \t,\tcase\n\t  \t\t\twhen lead(base.bill_date::date, 1) over (partition by base.project_id, base.project_fee_id, base.fiscal_quarter order by base.bill_date::date) is not null\n\t  \t\t\t\tthen lead(base.bill_date::date, 1) over (partition by base.project_id, base.project_fee_id, base.fiscal_quarter order by base.bill_date::date)\n\t  \t\t\telse dateadd('weeks', 1, base.bill_date::date)\n\t  \t\tend\tas bill_date\n\t  \t,\tcase\n\t  \t\t\twhen lead(base.fiscal_month, 1) over (partition by base.project_id, base.project_fee_id, base.fiscal_quarter order by base.bill_date::date) is not null\n\t  \t\t\t\tthen lead(base.fiscal_month, 1) over (partition by base.project_id, base.project_fee_id, base.fiscal_quarter order by base.bill_date::date)\n\t  \t\t\telse rdd.fiscal_month\n\t  \t\tend\tas fiscal_month\n\t  \t,\tcase\n\t  \t\t\twhen lead(base.fiscal_quarter, 1) over (partition by base.project_id, base.project_fee_id, base.fiscal_quarter order by base.bill_date::date) is not null\n\t\t\t\t\tthen lead(base.fiscal_quarter, 1) over (partition by base.project_id, base.project_fee_id, base.fiscal_quarter order by base.bill_date::date)\n\t  \t\t\telse rdd.fiscal_quarter\n\t  \t\tend\tas fiscal_quarter\n\t  \t,\tbase.revenue_status\n\t\t,\tbase.billing_type_id\n\t\t,\tbase.frequency\n\t\t,\tbase.recurring\n\t\t,\tbase.fee_excess_amount\n\t    ,\trank() over (partition by base.project_fee_history_id, base.fiscal_month, base.fiscal_quarter order by base.bill_date desc) as rank_num\n\tfrom\t$T{distribute revenue for closed} base\n\t\tleft join reporting.dim_date rdd\n  \t\t\ton dateadd('weeks', 1, base.bill_date::date) = rdd.calendar_date\n)\n\n, cte_filter_overflows\nas (\n\tselect\tproject_fee_history_id\n\t\t,\tproject_id\n\t\t,\tproject_fee_id\n\t\t,\tclient_id\n\t\t,\torder_invoice_id\n\t\t,\tinvoice_number\n\t\t,\tinvoice_date\n\t\t,\tfee_amount\n\t\t,\ttotal_qtr_revenue\n  \t\t,\tweekly_revenue_amount\n\t    ,\tcase\n  \t\t\t\twhen order_invoice_id is not null\n  \t\t\t\t\tthen fee_excess_amount\n  \t\t\t\telse 0\n  \t\t\tend as revenue_amount\n\t    ,\tcase\n  \t\t\t\twhen order_invoice_id is null\n  \t\t\t\t\tthen fee_excess_amount\n  \t\t\t\telse 0\n  \t\t\tend as estimated_wip_revenue\n\t\t,\tfee_excess_amount\n\t\t,\tbill_date\n\t  \t,\tfiscal_month\n\t  \t,\tfiscal_quarter\n\t  \t,\trevenue_status\n\t\t,\tbilling_type_id\n\t\t,\tfrequency\n\t\t,\trecurring\n\tfrom\tcte_calc_overflows\n\twhere\trank_num = 1 and fee_excess_amount <> 0\n)\n\n, cte_union\nas (\n\tselect\tproject_fee_history_id\n\t\t,\tproject_id\n\t\t,\tproject_fee_id\n\t\t,\tclient_id\n\t\t,\torder_invoice_id\n\t\t,\tinvoice_number\n\t\t,\tinvoice_date\n\t\t,\tfee_amount\n\t\t,\ttotal_qtr_revenue\n  \t\t,\tweekly_revenue_amount\n\t\t,\trevenue_amount\n\t\t,\testimated_wip_revenue\n\t\t,\tbill_date\n\t  \t,\tfiscal_month\n\t  \t,\tfiscal_quarter\n\t  \t,\trevenue_status\n\t\t,\tbilling_type_id\n\t\t,\tfrequency\n\t\t,\trecurring\n\t  \t,\ttrue as is_overflow\n\tfrom\tcte_filter_overflows\n\tunion\tall\n\tselect\tproject_fee_history_id\n\t\t,\tproject_id\n\t\t,\tproject_fee_id\n\t\t,\tclient_id\n\t\t,\torder_invoice_id\n\t\t,\tinvoice_number\n\t\t,\tinvoice_date\n\t\t,\tfee_amount\n\t\t,\ttotal_qtr_revenue\n  \t\t,\tweekly_revenue_amount\n\t     ,\tcase\n            \twhen order_invoice_id is not null\n                \tthen weekly_revenue_amount\n            \telse 0\n\t\t\tend as revenue_amount\n\t     ,\tcase\n\t\t\t\twhen order_invoice_id is null\n\t\t\t\t\tthen weekly_revenue_amount\n\t\t\t\telse 0\n\t\t\tend as estimated_wip_revenue\n\t\t,\tbill_date\n\t  \t,\tfiscal_month\n\t  \t,\tfiscal_quarter\n\t\t,\trevenue_status\n\t\t,\tbilling_type_id\n\t\t,\tfrequency\n\t\t,\trecurring\n\t  \t,\tfalse as is_overflow\n\tfrom\t$T{distribute revenue for closed}\n\torder\tby\tbill_date,project_fee_history_id\n)\n\n, cte_flag_overrides\nas (\n\tselect\t*\n\t\t,\tcase when max(case when is_overflow = true then 1 else 0 end) over (partition by project_fee_id, bill_date, fiscal_month) > 0 then true else false end as is_override\n\tfrom\tcte_union\n\torder\tby\tbill_date, project_fee_history_id\n)\n\n, cte_windowcalc_rows_with_overflows\nas (\n\tselect\tproject_fee_history_id\n\t\t,\tproject_id\n\t\t,\tproject_fee_id\n\t\t,\tclient_id\n\t\t,\torder_invoice_id\n\t\t,\tinvoice_number\n\t\t,\tinvoice_date\n\t\t,\tfee_amount\n\t\t,\ttotal_qtr_revenue\n\t\t,\tweekly_revenue_amount\n\t    ,\tcase\n\t\t\t\twhen is_overflow = false and is_override = true and revenue_amount <> 0\n\t  \t\t\t\tthen revenue_amount - (lag(revenue_amount)over(partition by project_fee_id,bill_date order by project_fee_history_id) + lag(estimated_wip_revenue)over(partition by project_fee_id,bill_date order by project_fee_history_id))\n\t  \t\t\telse revenue_amount\n\t  \t\tend as revenue_amount\n\t\t,\tcase\n\t\t\t\twhen is_overflow = false and is_override = true and estimated_wip_revenue <> 0\n\t  \t\t\t\tthen estimated_wip_revenue - (lag(revenue_amount)over(partition by project_fee_id,bill_date order by project_fee_history_id) + lag(estimated_wip_revenue)over(partition by project_fee_id,bill_date order by project_fee_history_id))\n\t  \t\t\telse estimated_wip_revenue\n\t  \t\tend as estimated_wip_revenue\n\t    ,\tbill_date\n\t  \t,\tfiscal_month\n\t  \t,\tfiscal_quarter\n\t\t,\trevenue_status\n\t\t,\tbilling_type_id\n\t\t,\tfrequency\n\t\t,\trecurring\n\t  \t,\tis_overflow\n\t  \t,\tis_override\n\tfrom\tcte_flag_overrides\n\torder\tby\tbill_date, project_fee_history_id\n)\n\nselect\tproject_fee_history_id\n\t,\tproject_id\n\t,\tproject_fee_id\t\n\t,\tclient_id\n    ,\torder_invoice_id\n\t,\tinvoice_number\n    ,\tinvoice_date\n\t,\tfee_amount    \n    ,\ttotal_qtr_revenue\n\t,\tweekly_revenue_amount\n\t,\trevenue_amount\n\t,\testimated_wip_revenue\n    ,\trevenue_status\n\t,\tbilling_type_id\n    ,\tbill_date\n  \t,\tfiscal_month\n  \t,\tfiscal_quarter\t\n\t,\tfrequency\n\t,\trecurring\nfrom\tcte_windowcalc_rows_with_overflows\norder\tby\tbill_date, project_fee_history_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004721":{"id":2004721,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":816,"y":720,"width":32,"height":32,"inputConnectorIDs":[2004705,2004711,2004712,2004751,2004757,2004772,2004790,2004822,2004825],"outputConnectorIDs":[2004799],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join 0"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"unite project_fee_history"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_source_system"},"2":{"slot":2,"type":"STRING","value":"dss"},"3":{"slot":3,"type":"STRING","value":"Inner"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"},"2":{"slot":2,"type":"STRING","value":"dd"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"},"2":{"slot":2,"type":"STRING","value":"dd_wes"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"dim_project"},"2":{"slot":2,"type":"STRING","value":"dp"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"},"2":{"slot":2,"type":"STRING","value":"dc"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"dim_market"},"2":{"slot":2,"type":"STRING","value":"dm"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"dim_currency"},"2":{"slot":2,"type":"STRING","value":"dcurr"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"dim_employee"},"2":{"slot":2,"type":"STRING","value":"de"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_fee_history STATE"},"2":{"slot":2,"type":"STRING","value":"state"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"dss\".\"source_system_sk\"=1"},"2":{"slot":2,"type":"STRING","value":"rrspfh_Inner_dss"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"bill_date\"::date=\"dd\".\"calendar_date\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_dd"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"\"dd\".\"week_ending_sunday\"=\"dd_wes\".\"calendar_date\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_dd_wes"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"project_id\"=\"dp\".\"project_id\"\nand\n\"dp\".\"current_record_ind\"=true"},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_dp"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"client_id\"=\"dc\".\"source_client_id\"\nand\n\"dc\".\"source_system_sk\"=1\nand\n\"dc\".\"current_record_ind\"=true"},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_dc"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"\"dc\".\"market_id\"=\"dm\".\"market_id\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_dm"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"\"dc\".\"client_currency_sk\"=\"dcurr\".\"currency_sk\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_dcurr"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"cw_user_id\"=nvl(\"de\".\"cloudwall_id\", \"de\".\"cloudwall_talent_id\")\nand\n\"rrspfh\".\"timeslip_date\" between \"de\".\"hire_date\" and \"de\".\"termination_date\"\nand\n\"de\".\"current_record_ind\" = true"},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_de"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"project_fee_history_id\" = \"state\".\"id\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_state"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dss.source_system_sk"},"2":{"slot":2,"type":"STRING","value":"source_system_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"dss.source_system_name"},"2":{"slot":2,"type":"STRING","value":"source_system"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"de.employee_sk"},"2":{"slot":2,"type":"STRING","value":"employee_sk"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"dd_wes.date_sk"},"2":{"slot":2,"type":"STRING","value":"approval_week_ending_sunday_sk"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"dd_wes.date_sk"},"2":{"slot":2,"type":"STRING","value":"working_week_ending_sunday_sk"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"dp.project_sk"},"2":{"slot":2,"type":"STRING","value":"project_sk"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"dc.client_sk"},"2":{"slot":2,"type":"STRING","value":"client_sk"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"dm.market_sk"},"2":{"slot":2,"type":"STRING","value":"market_sk"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"dcurr.currency_sk"},"2":{"slot":2,"type":"STRING","value":"currency_sk"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_history_id"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_id"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"dc.market_id"},"2":{"slot":2,"type":"STRING","value":"market_id"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"dcurr.currency_id"},"2":{"slot":2,"type":"STRING","value":"currency_id"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"dcurr.exchange_rate_id"},"2":{"slot":2,"type":"STRING","value":"exchange_rate_id"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weekly_revenue_amount"},"2":{"slot":2,"type":"STRING","value":"weekly_revenue_amount"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"dd.week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"approval_week_ending_sunday"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"dd.week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"working_week_ending_sunday"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_qtr_revenue"},"2":{"slot":2,"type":"STRING","value":"total_qtr_revenue"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.first_fmonth"},"2":{"slot":2,"type":"STRING","value":"first_fmonth"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weeks_per_month"},"2":{"slot":2,"type":"STRING","value":"weeks_per_month"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weeks_per_qtr"},"2":{"slot":2,"type":"STRING","value":"weeks_per_qtr"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.prev_weeks_qtr"},"2":{"slot":2,"type":"STRING","value":"prev_weeks_qtr"}}},"35":{"slot":35,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"36":{"slot":36,"values":{"1":{"slot":1,"type":"STRING","value":"dp.engagement_id"},"2":{"slot":2,"type":"STRING","value":"engagement_id"}}},"37":{"slot":37,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"project_billing_type_id"}}},"38":{"slot":38,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.timeslip_id"},"2":{"slot":2,"type":"STRING","value":"timeslip_id"}}},"39":{"slot":39,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.timeslip_date"},"2":{"slot":2,"type":"STRING","value":"timeslip_date"}}},"40":{"slot":40,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.timesheet_id"},"2":{"slot":2,"type":"STRING","value":"timesheet_id"}}},"41":{"slot":41,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.cw_user_id"},"2":{"slot":2,"type":"STRING","value":"employee_person_id"}}},"42":{"slot":42,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.bill_rate"},"2":{"slot":2,"type":"STRING","value":"bill_rate"}}},"43":{"slot":43,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.pay_rate"},"2":{"slot":2,"type":"STRING","value":"pay_rate"}}},"44":{"slot":44,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.hours"},"2":{"slot":2,"type":"STRING","value":"hours"}}},"45":{"slot":45,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.timesheet_status_date"},"2":{"slot":2,"type":"STRING","value":"timesheet_status_date"}}},"46":{"slot":46,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.timesheet_status"},"2":{"slot":2,"type":"STRING","value":"timesheet_status"}}},"47":{"slot":47,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}},"48":{"slot":48,"values":{"1":{"slot":1,"type":"STRING","value":"state.state"},"2":{"slot":2,"type":"STRING","value":"source_soft_delete_ind"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004722":{"id":2004722,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":-80,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004770],"outputConnectorIDs":[2004709,2004783],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calc timeslip amounts"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"case when nvl(\"hours\", 0) != 0 then \"bill_rate\" * (nvl(\"hours\", 0) / 60.00) else 0 end"},"2":{"slot":2,"type":"STRING","value":"timeslip_amount"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"case when nvl(\"hours\", 0) != 0 then nvl(\"hours\", 0) / 60.00 else 0.00 end"},"2":{"slot":2,"type":"STRING","value":"hours"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004723":{"id":2004723,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-272,"y":304,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004800],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_user"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_user"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"cw_user_id"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004724":{"id":2004724,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":592,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004707],"outputConnectorIDs":[2004777],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calc estimated_wip_revenue"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"case when \"order_invoice_id\" is null then \"timeslip_amount\" * \"estimated_wip_fraction\"\nelse\n\tcase when nvl(\"fee_invoiced_amount\", 0) = 0 or nvl(\"total_fee_invoiced_amount\", 0) = 0 then 0\n    else\n      case when \"total_timeslip_amount\" > \"total_fee_invoiced_amount\" then\n          (\"timeslip_amount\" * (\"fee_invoiced_amount\" / \"total_fee_invoiced_amount\")) - \"revenue_amount\"\n      else 0 end\n    end\nend"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004725":{"id":2004725,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":448,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004767],"outputConnectorIDs":[2004707],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calc revenue amount"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"case when \"order_invoice_id\" is not null then \n\tcase when nvl(\"timeslip_amount\", 0) = 0 or nvl(\"total_timeslip_amount\", 0) = 0 then 0\n\telse (\"timeslip_amount\" / \"total_timeslip_amount\") * \"fee_invoiced_amount\" end\nelse 0 end::numeric(31,4)"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004726":{"id":2004726,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":128170095,"x":592,"y":480,"width":32,"height":32,"inputConnectorIDs":[2004777],"outputConnectorIDs":[2004769],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select cols"}}}},"visible":true},"2":{"slot":2,"name":"Column Mapping","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"project_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"project_fee_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"billing_type_id"},"2":{"slot":2,"type":"STRING","value":"billing_type_id"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"amount"},"2":{"slot":2,"type":"STRING","value":"amount"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"fee_invoiced_amount"},"2":{"slot":2,"type":"STRING","value":"fee_invoiced_amount"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"fee_estimated_wip_amount"},"2":{"slot":2,"type":"STRING","value":"fee_estimated_wip_amount"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"total_fee_invoiced_amount"},"2":{"slot":2,"type":"STRING","value":"total_fee_invoiced_amount"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"total_fee_estimated_wip_amount"},"2":{"slot":2,"type":"STRING","value":"total_fee_estimated_wip_amount"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip_id"},"2":{"slot":2,"type":"STRING","value":"timeslip_id"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"cw_user_id"},"2":{"slot":2,"type":"STRING","value":"cw_user_id"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"task_id"},"2":{"slot":2,"type":"STRING","value":"task_id"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip_date"},"2":{"slot":2,"type":"STRING","value":"timeslip_date"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"hours"},"2":{"slot":2,"type":"STRING","value":"hours"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"bill_rate"},"2":{"slot":2,"type":"STRING","value":"bill_rate"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"pay_rate"},"2":{"slot":2,"type":"STRING","value":"pay_rate"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_id"},"2":{"slot":2,"type":"STRING","value":"timesheet_id"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_status_date"},"2":{"slot":2,"type":"STRING","value":"timesheet_status_date"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_status"},"2":{"slot":2,"type":"STRING","value":"timesheet_status"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip_amount"},"2":{"slot":2,"type":"STRING","value":"timeslip_amount"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"total_timeslip_amount"},"2":{"slot":2,"type":"STRING","value":"total_timeslip_amount"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}}},"visible":true},"3":{"slot":3,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004727":{"id":2004727,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-464,"y":304,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004756],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_timesheet"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_timesheet"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"modified_on"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"status"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004728":{"id":2004728,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":320,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004709,2004778],"outputConnectorIDs":[2004767],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join timeslip totals"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calc timeslip amounts"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Aggr timeslip amount per project"},"2":{"slot":2,"type":"STRING","value":"aggr"},"3":{"slot":3,"type":"STRING","value":"Inner"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"project_id\"=\"aggr\".\"project_id\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Inner_aggr"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"billing_type_id"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.amount"},"2":{"slot":2,"type":"STRING","value":"amount"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_fees_amount"},"2":{"slot":2,"type":"STRING","value":"total_fees_amount"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_invoiced_amount"},"2":{"slot":2,"type":"STRING","value":"fee_invoiced_amount"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_estimated_wip_amount"},"2":{"slot":2,"type":"STRING","value":"fee_estimated_wip_amount"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_fee_invoiced_amount"},"2":{"slot":2,"type":"STRING","value":"total_fee_invoiced_amount"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_fee_estimated_wip_amount"},"2":{"slot":2,"type":"STRING","value":"total_fee_estimated_wip_amount"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.estimated_wip_fraction"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_fraction"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.timeslip_id"},"2":{"slot":2,"type":"STRING","value":"timeslip_id"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.cw_user_id"},"2":{"slot":2,"type":"STRING","value":"cw_user_id"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.task_id"},"2":{"slot":2,"type":"STRING","value":"task_id"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.timeslip_date"},"2":{"slot":2,"type":"STRING","value":"timeslip_date"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.hours"},"2":{"slot":2,"type":"STRING","value":"hours"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.bill_rate"},"2":{"slot":2,"type":"STRING","value":"bill_rate"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.pay_rate"},"2":{"slot":2,"type":"STRING","value":"pay_rate"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.timesheet_id"},"2":{"slot":2,"type":"STRING","value":"timesheet_id"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.timesheet_status_date"},"2":{"slot":2,"type":"STRING","value":"timesheet_status_date"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.timesheet_status"},"2":{"slot":2,"type":"STRING","value":"timesheet_status"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.timeslip_amount"},"2":{"slot":2,"type":"STRING","value":"timeslip_amount"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"aggr.sum_timeslip_amount"},"2":{"slot":2,"type":"STRING","value":"total_timeslip_amount"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004729":{"id":2004729,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1744268877,"x":48,"y":416,"width":32,"height":32,"inputConnectorIDs":[2004783],"outputConnectorIDs":[2004788],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Distinct timeslips by project"}}}},"visible":true},"2":{"slot":2,"name":"Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"cw_user_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"task_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip_date"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip_amount"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_id"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_status_date"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_status"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004730":{"id":2004730,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":592,"y":864,"width":32,"height":32,"inputConnectorIDs":[2004771],"outputConnectorIDs":[2004780],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calculate cols"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"case when \"order_invoice_id\" is not null then \"amount\" else 0 end"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"case when \"order_invoice_id\" is null then \"amount\" else 0 end"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"\"amount\""},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"\"bill_date\"::date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004731":{"id":2004731,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":-368,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004756,2004781,2004786,2004791,2004800,2004823],"outputConnectorIDs":[2004770],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join timeslips"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calc estimated wip percentage"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_task"},"2":{"slot":2,"type":"STRING","value":"task"},"3":{"slot":3,"type":"STRING","value":"Inner"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"exclude 0 hours"},"2":{"slot":2,"type":"STRING","value":"timeslip"},"3":{"slot":3,"type":"STRING","value":"Inner"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"dim date"},"2":{"slot":2,"type":"STRING","value":"dd"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_user"},"2":{"slot":2,"type":"STRING","value":"rrsu"},"3":{"slot":3,"type":"STRING","value":"Inner"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_timesheet"},"2":{"slot":2,"type":"STRING","value":"rrsht"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"project_id\"=\"task\".\"project_id\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Inner_task"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"\"task\".\"id\"=\"timeslip\".\"task_id\"\nand\n\"timeslip\".\"state\"!=2"},"2":{"slot":2,"type":"STRING","value":"rrspfh_Inner_timeslip"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"\"timeslip\".\"timeslip_date\"::date=\"dd\".\"calendar_date\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_dd"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"\"timeslip\".\"user_id\"=\"rrsu\".\"id\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Inner_rrsu"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"\"timeslip\".\"timesheet_id\"=\"rrsht\".\"id\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_rrsht"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"billing_type_id"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.amount"},"2":{"slot":2,"type":"STRING","value":"amount"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_fees_amount"},"2":{"slot":2,"type":"STRING","value":"total_fees_amount"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_invoiced_amount"},"2":{"slot":2,"type":"STRING","value":"fee_invoiced_amount"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_estimated_wip_amount"},"2":{"slot":2,"type":"STRING","value":"fee_estimated_wip_amount"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_fee_invoiced_amount"},"2":{"slot":2,"type":"STRING","value":"total_fee_invoiced_amount"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_fee_estimated_wip_amount"},"2":{"slot":2,"type":"STRING","value":"total_fee_estimated_wip_amount"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.estimated_wip_fraction"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_fraction"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip.id"},"2":{"slot":2,"type":"STRING","value":"timeslip_id"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"rrsu.cw_user_id"},"2":{"slot":2,"type":"STRING","value":"cw_user_id"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip.task_id"},"2":{"slot":2,"type":"STRING","value":"task_id"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip.timeslip_date"},"2":{"slot":2,"type":"STRING","value":"timeslip_date"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip.hours"},"2":{"slot":2,"type":"STRING","value":"hours"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip.bill_rate"},"2":{"slot":2,"type":"STRING","value":"bill_rate"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip.pay_rate"},"2":{"slot":2,"type":"STRING","value":"pay_rate"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip.timesheet_id"},"2":{"slot":2,"type":"STRING","value":"timesheet_id"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"rrsht.modified_on"},"2":{"slot":2,"type":"STRING","value":"timesheet_status_date"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"rrsht.status"},"2":{"slot":2,"type":"STRING","value":"timesheet_status"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"dd.week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"dd.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"dd.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004732":{"id":2004732,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":816,"y":576,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004757],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_employee"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_employee"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"employee_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"cloudwall_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"cloudwall_talent_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"current_record_ind"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"hire_date"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"termination_date"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004733":{"id":2004733,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":-912,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004708],"outputConnectorIDs":[2004773],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calc invoiced and not"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"case when \"order_invoice_id\" is not null then \"amount\" else 0 end"},"2":{"slot":2,"type":"STRING","value":"fee_invoiced_amount"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"case when \"order_invoice_id\" is null then \"amount\" else 0 end"},"2":{"slot":2,"type":"STRING","value":"fee_estimated_wip_amount"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"\"amount\""},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004734":{"id":2004734,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-368,"y":256,"width":32,"height":32,"inputConnectorIDs":[2004762],"outputConnectorIDs":[2004791],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exclude 0 hours"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"hours"},"2":{"slot":2,"type":"STRING","value":"Not"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"0"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"bill_rate"},"2":{"slot":2,"type":"STRING","value":"Not"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"0"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004735":{"id":2004735,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":-608,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004792],"outputConnectorIDs":[2004781],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calc estimated wip percentage"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"case when \"total_fees_amount\" = 0 or \"fee_estimated_wip_amount\" = 0 then 0 else \"fee_estimated_wip_amount\" / \"total_fees_amount\" end::decimal(31, 4)"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_fraction"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004736":{"id":2004736,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":335239555,"x":1104,"y":720,"width":32,"height":32,"inputConnectorIDs":[2004799],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rewrite stg1_robohead_studios_fact_financial_metrics_project_fees"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg1_robohead_studios_fact_financial_metrics_project_fees"}}}},"visible":true},"3":{"slot":3,"name":"Table Sort Key","elements":{},"visible":true},"4":{"slot":4,"name":"Table Distribution Style","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Even"}}}},"visible":true},"5":{"slot":5,"name":"Table Distribution Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"staging"}}}},"visible":true},"7":{"slot":7,"name":"Sort Key Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Compound"}}}},"visible":false}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004737":{"id":2004737,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":-624,"y":480,"width":32,"height":32,"inputConnectorIDs":[2004789],"outputConnectorIDs":[2004763],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calc closing date"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DATEADD ( day, 15, \"max_week_ending_sunday\" )"},"2":{"slot":2,"type":"STRING","value":"closing_date"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"case when sysdate::date >= DATEADD ( day, 15, \"max_week_ending_sunday\" ) then true else false end"},"2":{"slot":2,"type":"STRING","value":"is_qtr_closed"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004738":{"id":2004738,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-1056,"y":864,"width":32,"height":32,"inputConnectorIDs":[2004785],"outputConnectorIDs":[2004771],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Non-monthly fees"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"frequency"},"2":{"slot":2,"type":"STRING","value":"Not"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"546"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004739":{"id":2004739,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-624,"y":784,"width":32,"height":32,"inputConnectorIDs":[2004713],"outputConnectorIDs":[2004795],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"filter closed qtr"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"is_qtr_closed"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"true"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004740":{"id":2004740,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-208,"y":784,"width":32,"height":32,"inputConnectorIDs":[2004795],"outputConnectorIDs":[2004798],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"breakdown to weekly"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with cte_monthly\nas (\n\tselect \n  \t\t\tbase.project_fee_history_id\n\t\t,\tbase.project_id\n\t\t,\tbase.project_fee_id\n\t\t,\tbase.revenue_status\n\t\t,\tbase.billing_type_id\n\t\t,\tbase.project_fee_id_count\n\t\t,\tbase.client_id\n\t\t,\tbase.order_invoice_id\n\t\t,\tbase.invoice_number\n\t\t,\tbase.invoice_date\n\t\t,\tbase.fiscal_month\t\t\tas invoice_month\n\t\t,\tsum(base.fee_amount)\t\tas fee_amount\n\t\t,\tsum(base.revenue_amount + base.estimated_wip_revenue) over (partition by base.project_id, base.project_fee_id, base.fiscal_quarter) as total_qtr_revenue\n\t\t,\tbase.revenue_amount\n\t\t,\tbase.estimated_wip_revenue\n\t\t,\tbase.frequency\n\t\t,\tbase.recurring\n\t\t,\tmax(base.no_of_wks_month)\tas weeks_month\n\t\t,\tcase\n  \t\t   \t\twhen max(base.project_fee_id_count) >= 3\n\t  \t\t\t\tthen max(no_of_weeks)\n\t  \t\t\telse sum(max(base.no_of_wks_month)) over (partition by base.project_id, base.project_fee_id, base.fiscal_quarter)\n\t\t\tend as total_weeks\n\t\t,\tbase.fiscal_month\n\t\t,\tbase.fiscal_quarter\n\t\t,\tbase.bill_date\n\t\t,\tmax(max(base.fiscal_month)) over (partition by base.project_id, base.project_fee_id, base.fiscal_quarter) as\tlast_fmonth\n\tfrom $T{filter closed qtr} base\n\tgroup by base.project_fee_history_id, base.project_id, base.project_fee_id, base.revenue_status, base.billing_type_id, base.project_fee_id_count,\n\t  \t\t base.client_id, base.order_invoice_id, base.invoice_number, base.invoice_date, base.revenue_amount, base.estimated_wip_revenue, base.frequency, base.recurring,\n\t  \t\t base.fiscal_month, base.fiscal_quarter, base.bill_date\n\torder by base.project_id, base.project_fee_id, base.fiscal_month, base.bill_date\n)\n\n, cte_weekly\nas (\n  select\t*\n  \t\t,\ttotal_qtr_revenue / total_weeks\tas weekly_revenue_amount\n  from\tcte_monthly\n)\n\n, cte_excess\nas (\n\tselect\t*\n\t\t,\tweekly_revenue_amount * weeks_month as calc_monthly_revenue_amount\n\t    ,\tcase\n\t    \t\twhen fiscal_month != last_fmonth\n\t    \t\t\tthen fee_amount - (weekly_revenue_amount * weeks_month)\n\t        \telse 0\n\t        end\tas\tfee_excess\n\tfrom\tcte_weekly\t\n )\n\n, cte_excess_2\nas (\n\tselect\t*\n\t    ,\tcase\n\t    \t\twhen fiscal_month != last_fmonth\n\t    \t\t\tthen fee_amount + coalesce(lag(fee_excess,1)over(partition by project_fee_id,fiscal_quarter order by bill_date asc),0) - (weekly_revenue_amount * weeks_month)\n\t        \telse 0\n\t        end\tas\tfee_excess_amount\n\tfrom\tcte_excess\n)\n\nselect \tproject_fee_history_id\n\t,\tproject_id\n\t,\tproject_fee_id\n\t,\trevenue_status\n\t,\tbilling_type_id\n\t,\tproject_fee_id_count\n\t,\tclient_id\n\t,\torder_invoice_id\n\t,\tinvoice_number\n\t,\tinvoice_date\n\t,\tinvoice_month\n\t,\tfee_amount\n\t,\trevenue_amount\n\t,\ttotal_qtr_revenue\n\t,\testimated_wip_revenue\n\t,\tfrequency\n\t,\trecurring\n\t,\tweeks_month\n\t,\ttotal_weeks\n\t,\tfiscal_month\n\t,\tfiscal_quarter\n\t,\tbill_date\n\t,\tlast_fmonth\n    ,\tweekly_revenue_amount\n    ,\tcalc_monthly_revenue_amount\n    ,\tfee_excess_amount\nfrom\tcte_excess_2\norder\tby\tfiscal_month, fiscal_quarter, project_fee_history_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004741":{"id":2004741,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-624,"y":624,"width":32,"height":32,"inputConnectorIDs":[2004829],"outputConnectorIDs":[2004824],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter not closed"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"is_qtr_closed"},"2":{"slot":2,"type":"STRING","value":"Not"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"true"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004742":{"id":2004742,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1744268877,"x":288,"y":704,"width":32,"height":32,"inputConnectorIDs":[2004758],"outputConnectorIDs":[2004760,2004796],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Distinct WES / month"}}}},"visible":true},"2":{"slot":2,"name":"Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004743":{"id":2004743,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":208,"y":784,"width":32,"height":32,"inputConnectorIDs":[2004796,2004798],"outputConnectorIDs":[2004793],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"distribute revenue for closed"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"breakdown to weekly"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Distinct WES / month"},"2":{"slot":2,"type":"STRING","value":"mnth"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"fiscal_month\"=\"mnth\".\"fiscal_month\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_mnth"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_qtr_revenue"},"2":{"slot":2,"type":"STRING","value":"total_qtr_revenue"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weekly_revenue_amount"},"2":{"slot":2,"type":"STRING","value":"weekly_revenue_amount"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"mnth.week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"mnth.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"mnth.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"billing_type_id"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_excess_amount"},"2":{"slot":2,"type":"STRING","value":"fee_excess_amount"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weeks_month"},"2":{"slot":2,"type":"STRING","value":"weeks_month"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_weeks"},"2":{"slot":2,"type":"STRING","value":"total_weeks"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004744":{"id":2004744,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":-368,"y":624,"width":32,"height":32,"inputConnectorIDs":[2004779,2004824],"outputConnectorIDs":[2004794,2004827],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join future dd attributes"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter not closed"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"build future dd attributes"},"2":{"slot":2,"type":"STRING","value":"dd"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"fiscal_month\"=\"dd\".\"fiscal_month\"\nand\n\"rrspfh\".\"fiscal_quarter\"=\"dd\".\"fiscal_quarter\"\n"},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_dd"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_id_count"},"2":{"slot":2,"type":"STRING","value":"project_fee_id_count"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"billing_type_id"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.last_wes"},"2":{"slot":2,"type":"STRING","value":"last_wes"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.closing_date"},"2":{"slot":2,"type":"STRING","value":"closing_date"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.is_qtr_closed"},"2":{"slot":2,"type":"STRING","value":"is_qtr_closed"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"dd.month_rank"},"2":{"slot":2,"type":"STRING","value":"month_rank"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"dd.weeks_per_month"},"2":{"slot":2,"type":"STRING","value":"weeks_per_month"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"dd.weeks_per_qtr"},"2":{"slot":2,"type":"STRING","value":"weeks_per_qtr"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"dd.prev_weeks_qtr"},"2":{"slot":2,"type":"STRING","value":"prev_weeks_qtr"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004745":{"id":2004745,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-208,"y":560,"width":32,"height":32,"inputConnectorIDs":[2004759],"outputConnectorIDs":[2004704,2004779],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"build future dd attributes"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with cte_month_statistics\n    as (select fiscal_month\n             , fiscal_quarter\n             , rank() over (partition by fiscal_quarter order by fiscal_month) as month_rank\n             , count_distinct_week_ending_sunday\tas\tweeks_per_month\n\n             , sum(weeks_per_month) over (partition by fiscal_quarter)\tas\tweeks_per_qtr\n        from $T{Get wes count per month})\n   , cte_additional_month_stats\n    as (select *\n             , case when month_rank != 1 then lag(weeks_per_month, 1) over (order by fiscal_month, fiscal_quarter) else 0 end   as  prev_weeks_qtr\n        from cte_month_statistics)\nselect *\n\t,\t546\tas\tfrequency\n    ,\t1\tas\trecurring\nfrom cte_additional_month_stats\norder by fiscal_month"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004746":{"id":2004746,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-1056,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004797],"outputConnectorIDs":[2004708],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Monthly non-recurring fees"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"frequency"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"546"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"recurring"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"2"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004747":{"id":2004747,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":-48,"y":624,"width":32,"height":32,"inputConnectorIDs":[2004704,2004706,2004710],"outputConnectorIDs":[2004830],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"assign wes"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get fee unit by project"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"build future dd attributes"},"2":{"slot":2,"type":"STRING","value":"dd"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Get invoices per project_id per fiscal_month"},"2":{"slot":2,"type":"STRING","value":"inv"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"dd\".\"fiscal_quarter\"=\"rrspfh\".\"fiscal_quarter\"\nand\n\"rrspfh\".\"first_fmonth\"<=\"dd\".\"month_rank\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_dd"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"project_id\"=\"inv\".\"project_id\"\nand\n\"rrspfh\".\"project_fee_id\"=\"inv\".\"project_fee_id\"\nand\n\"rrspfh\".\"fiscal_quarter\"=\"inv\".\"fiscal_quarter\"\nand\n\"dd\".\"fiscal_month\"=\"inv\".\"fiscal_month\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_inv"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"inv.project_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"inv.revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"inv.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"billing_type_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"inv.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"inv.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"inv.invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"inv.invoice_month"},"2":{"slot":2,"type":"STRING","value":"invoice_month"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"dd.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"dd.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_qtr_revenue"},"2":{"slot":2,"type":"STRING","value":"total_qtr_revenue"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weekly_revenue_amount"},"2":{"slot":2,"type":"STRING","value":"weekly_revenue_amount"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.first_fmonth"},"2":{"slot":2,"type":"STRING","value":"first_fmonth"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_weeks"},"2":{"slot":2,"type":"STRING","value":"total_weeks"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"dd.month_rank"},"2":{"slot":2,"type":"STRING","value":"month_rank"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"dd.weeks_per_month"},"2":{"slot":2,"type":"STRING","value":"weeks_per_month"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"dd.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"dd.weeks_per_qtr"},"2":{"slot":2,"type":"STRING","value":"weeks_per_qtr"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"dd.prev_weeks_qtr"},"2":{"slot":2,"type":"STRING","value":"prev_weeks_qtr"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004748":{"id":2004748,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-368,"y":480,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004715,2004752,2004786],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim date"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"date_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"calendar_date"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004749":{"id":2004749,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":-1056,"y":672,"width":32,"height":32,"inputConnectorIDs":[2004753,2004764,2004826,2004828,2004831],"outputConnectorIDs":[2004761,2004785,2004797],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"base project_fee_history"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Exclude state = 2"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_fee"},"2":{"slot":2,"type":"STRING","value":"rrspf"},"3":{"slot":3,"type":"STRING","value":"Inner"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"billing_type_id"},"2":{"slot":2,"type":"STRING","value":"rrsp"},"3":{"slot":3,"type":"STRING","value":"Inner"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"retainers_billed_by_fee"},"2":{"slot":2,"type":"STRING","value":"rrspp"},"3":{"slot":3,"type":"STRING","value":"Inner"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"raw_cloudwall_order_invoice"},"2":{"slot":2,"type":"STRING","value":"rcoi"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"project_fee_id\"=\"rrspf\".\"id\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Inner_rrspf"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"project_id\"=\"rrsp\".\"id\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Inner_rrsp"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrsp\".\"id\"=\"rrspp\".\"id\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Inner_rrspp"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"invoice_id\"=\"rcoi\".\"order_invoice_id\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_rcoi"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.id"},"2":{"slot":2,"type":"STRING","value":"project_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.project_fee_id"},"2":{"slot":2,"type":"STRING","value":"project_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rcoi.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"rcoi.order_invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.amount"},"2":{"slot":2,"type":"STRING","value":"amount"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.status_id"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrsp.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"billing_type_id"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"rrspf.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"rrspf.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"rrsp.budgeted_revenue"},"2":{"slot":2,"type":"STRING","value":"budgeted_revenue"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"rrsp.actual_revenue"},"2":{"slot":2,"type":"STRING","value":"actual_revenue"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004750":{"id":2004750,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1701703136,"x":-512,"y":480,"width":32,"height":32,"inputConnectorIDs":[2004752],"outputConnectorIDs":[2004789],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get max wes per qtr"}}}},"visible":true},"2":{"slot":2,"name":"Groupings","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}}},"visible":true},"3":{"slot":3,"name":"Aggregations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"Max"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"Count Distinct"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"2004704":{"id":2004704,"sourceID":2004745,"targetID":2004747},"2004705":{"id":2004705,"sourceID":2004678,"targetID":2004721},"2004706":{"id":2004706,"sourceID":2004672,"targetID":2004747},"2004707":{"id":2004707,"sourceID":2004725,"targetID":2004724},"2004708":{"id":2004708,"sourceID":2004746,"targetID":2004733},"2004709":{"id":2004709,"sourceID":2004722,"targetID":2004728},"2004710":{"id":2004710,"sourceID":2004689,"targetID":2004747},"2004711":{"id":2004711,"sourceID":2004693,"targetID":2004721},"2004712":{"id":2004712,"sourceID":2004716,"targetID":2004721},"2004713":{"id":2004713,"sourceID":2004687,"targetID":2004739},"2004715":{"id":2004715,"sourceID":2004748,"targetID":2004677},"2004751":{"id":2004751,"sourceID":2004683,"targetID":2004721},"2004752":{"id":2004752,"sourceID":2004748,"targetID":2004750},"2004753":{"id":2004753,"sourceID":2004679,"targetID":2004749},"2004754":{"id":2004754,"sourceID":2004674,"targetID":2004719},"2004755":{"id":2004755,"sourceID":2004719,"targetID":2004693},"2004756":{"id":2004756,"sourceID":2004727,"targetID":2004731},"2004757":{"id":2004757,"sourceID":2004732,"targetID":2004721},"2004758":{"id":2004758,"sourceID":2004685,"targetID":2004742},"2004759":{"id":2004759,"sourceID":2004677,"targetID":2004745},"2004760":{"id":2004760,"sourceID":2004742,"targetID":2004674},"2004761":{"id":2004761,"sourceID":2004749,"targetID":2004690},"2004762":{"id":2004762,"sourceID":2004702,"targetID":2004734},"2004763":{"id":2004763,"sourceID":2004737,"targetID":2004675},"2004764":{"id":2004764,"sourceID":2004691,"targetID":2004749},"2004765":{"id":2004765,"sourceID":2004684,"targetID":2004675},"2004766":{"id":2004766,"sourceID":2004688,"targetID":2004691},"2004767":{"id":2004767,"sourceID":2004728,"targetID":2004725},"2004768":{"id":2004768,"sourceID":2004675,"targetID":2004687},"2004769":{"id":2004769,"sourceID":2004726,"targetID":2004693},"2004770":{"id":2004770,"sourceID":2004731,"targetID":2004722},"2004771":{"id":2004771,"sourceID":2004738,"targetID":2004730},"2004772":{"id":2004772,"sourceID":2004685,"targetID":2004721},"2004773":{"id":2004773,"sourceID":2004733,"targetID":2004701},"2004774":{"id":2004774,"sourceID":2004673,"targetID":2004674},"2004775":{"id":2004775,"sourceID":2004720,"targetID":2004693},"2004776":{"id":2004776,"sourceID":2004676,"targetID":2004714},"2004777":{"id":2004777,"sourceID":2004724,"targetID":2004726},"2004778":{"id":2004778,"sourceID":2004718,"targetID":2004728},"2004779":{"id":2004779,"sourceID":2004745,"targetID":2004744},"2004780":{"id":2004780,"sourceID":2004730,"targetID":2004693},"2004781":{"id":2004781,"sourceID":2004735,"targetID":2004731},"2004782":{"id":2004782,"sourceID":2004677,"targetID":2004675},"2004783":{"id":2004783,"sourceID":2004722,"targetID":2004729},"2004784":{"id":2004784,"sourceID":2004690,"targetID":2004684},"2004785":{"id":2004785,"sourceID":2004749,"targetID":2004738},"2004786":{"id":2004786,"sourceID":2004748,"targetID":2004731},"2004787":{"id":2004787,"sourceID":2004717,"targetID":2004686},"2004788":{"id":2004788,"sourceID":2004729,"targetID":2004718},"2004789":{"id":2004789,"sourceID":2004750,"targetID":2004737},"2004790":{"id":2004790,"sourceID":2004680,"targetID":2004721},"2004791":{"id":2004791,"sourceID":2004734,"targetID":2004731},"2004792":{"id":2004792,"sourceID":2004701,"targetID":2004735},"2004793":{"id":2004793,"sourceID":2004743,"targetID":2004720},"2004794":{"id":2004794,"sourceID":2004744,"targetID":2004689},"2004795":{"id":2004795,"sourceID":2004739,"targetID":2004740},"2004796":{"id":2004796,"sourceID":2004742,"targetID":2004743},"2004797":{"id":2004797,"sourceID":2004749,"targetID":2004746},"2004798":{"id":2004798,"sourceID":2004740,"targetID":2004743},"2004799":{"id":2004799,"sourceID":2004721,"targetID":2004736},"2004800":{"id":2004800,"sourceID":2004723,"targetID":2004731},"2004822":{"id":2004822,"sourceID":2004703,"targetID":2004721},"2004823":{"id":2004823,"sourceID":2004692,"targetID":2004731},"2004824":{"id":2004824,"sourceID":2004741,"targetID":2004744},"2004825":{"id":2004825,"sourceID":2004681,"targetID":2004721},"2004826":{"id":2004826,"sourceID":2004686,"targetID":2004749},"2004827":{"id":2004827,"sourceID":2004744,"targetID":2004672},"2004828":{"id":2004828,"sourceID":2004714,"targetID":2004749},"2004829":{"id":2004829,"sourceID":2004687,"targetID":2004741},"2004830":{"id":2004830,"sourceID":2004747,"targetID":2004673},"2004831":{"id":2004831,"sourceID":2004682,"targetID":2004749}},"notes":{"2004695":{"id":2004695,"x":-326,"y":810,"width":250,"height":58,"text":"ADM-1210:\n- created new lines for revenue overflows to the next fiscal month.","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"stage1_robohead_studios_fact_financial_metrics_project_fees_rewrite","description":"","type":"TRANSFORMATION","tag":"2cfb4907-bfb7-4481-97f7-717d82d011c3"}}