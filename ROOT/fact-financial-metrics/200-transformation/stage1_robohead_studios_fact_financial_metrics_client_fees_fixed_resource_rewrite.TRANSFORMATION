{"job":{"components":{"2004064":{"id":2004064,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1456,"y":384,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004199],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_source_system"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_source_system"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"source_system_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"source_system_name"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004065":{"id":2004065,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1568,"y":240,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004187],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_employee"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_employee"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"employee_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"cloudwall_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"cloudwall_talent_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"current_record_ind"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004066":{"id":2004066,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1504,"y":256,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004188],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_market"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_market"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"market_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"market_id"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004067":{"id":2004067,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":0,"y":368,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004164],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_timeslip"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_timeslip"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"user_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"task_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip_date"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"hours"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"status"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_id"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"pay_rate"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004068":{"id":2004068,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":816,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004179,2004184],"outputConnectorIDs":[2004154,2004178],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"attach latest projects to fees"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with cte_resource_projects\nas (\n\tselect\n\t\t\tclient_fee_id\n\t\t,\tresource_id\n\t\t,\tproject_id\n\t\t,\tproject_billing_type_id\n\t\t,\tproject_state\n\t\t,\tproject_pivot_state\n\t\t,\tretainers_billed_by_fee\n\t\t,\trank()over(partition by client_fee_id order by bill_date desc) as rank_num\n\tfrom ($T{Filter for fees with timeslip_hours})\n)\n\n, cte_latest_projects\nas (\n\tselect distinct\n\t\t\tclient_fee_id\n\t\t,\tresource_id\n\t\t,\tproject_id\n\t\t,\tproject_billing_type_id\n\t\t,\tproject_state\n\t\t,\tproject_pivot_state\n\t\t,\tretainers_billed_by_fee\n\tfrom cte_resource_projects\n  \twhere rank_num = 1\n\torder by client_fee_id,project_id\n)\n\nselect\n\t\tfees.client_fee_history_id\n\t,\tfees.client_fee_history_state\n\t,\tfees.client_fee_id\n\t,\tfees.client_fee_state\n\t,\tfees.client_id\n\t,\tfees.resource_id\n\t,\tfees.frequency\n\t,\tfees.bill_interval_start\n\t,\tfees.bill_interval_end\n\t,\tfees.invoice_id\n\t,\tfees.revenue_amount\n\t,\tcte.project_id\n\t,\tcte.project_state\n\t,\tcte.retainers_billed_by_fee\n\t,\tcte.project_pivot_state\n\t,\tfees.timeslip_pay_rate\n\t,\tfees.timesheet_id\n\t,\tfees.invoice_number\n\t,\tfees.timesheet_status\n\t,\tfees.client_fee_fee_type_id\n\t,\tcte.project_billing_type_id\n\t,\tfees.revenue_status\n\t,\tfees.timesheet_approval_date\n\t,\tfees.recurring\n\t,\tfees.estimated_wip_revenue\n\t,\tfees.fiscal_month\n\t,\tfees.fiscal_quarter\n\t,\tfees.fee_amount\n\t,\tfees.bill_date\n\t,\tfees.sum_timeslip_hours\nfrom ($T{Filter for fees without timeslip_hours}) fees\n\tleft join cte_latest_projects cte\n    \ton \tfees.client_fee_id = cte.client_fee_id\n        and fees.resource_id = cte.resource_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004069":{"id":2004069,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":80,"y":0,"width":32,"height":32,"inputConnectorIDs":[2004222],"outputConnectorIDs":[2004180],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"add order invoice"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select\n\t  fees.client_fee_history_id\n\t, fees.client_fee_id\n\t, fees.fee_type_id\n\t, fees.bill_date\n\t, fees.fee_amount\n\t, fees.client_id\n\t, fees.resource_id\n\t, fees.status_id\n\t, fees.invoice_id\n\t, fees.invoice_number\n\t, fees.client_fee_history_state\n    , fees.client_fee_state\n\t, fees.frequency\n\t, fees.recurring\n\t, oi.order_invoice_id\nfrom ($T{Non-monthly fees}) fees\n     left join exploration.raw_cloudwall_order_invoice oi\n       on fees.invoice_id = oi.order_invoice_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004070":{"id":2004070,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":976,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004154],"outputConnectorIDs":[2004250],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"attached projects"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"},"2":{"slot":2,"type":"STRING","value":"Not"},"3":{"slot":3,"type":"STRING","value":"Null"},"4":{"slot":4,"type":"STRING","value":""}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004071":{"id":2004071,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":816,"y":272,"width":32,"height":32,"inputConnectorIDs":[2004178],"outputConnectorIDs":[2004161],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"no prev projects found"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Null"},"4":{"slot":4,"type":"STRING","value":""}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004072":{"id":2004072,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":335239555,"x":2448,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004235],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg1_robohead_studios_fact_financial_metrics_client_fees_fixed_resource"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg1_robohead_studios_fact_financial_metrics_client_fees_fixed_resource"}}}},"visible":true},"3":{"slot":3,"name":"Table Sort Key","elements":{},"visible":true},"4":{"slot":4,"name":"Table Distribution Style","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Even"}}}},"visible":true},"5":{"slot":5,"name":"Table Distribution Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"staging"}}}},"visible":true},"7":{"slot":7,"name":"Sort Key Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Compound"}}}},"visible":false}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004073":{"id":2004073,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":464,"y":400,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004151],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_task"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_task"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004075":{"id":2004075,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":880,"y":480,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004190],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"client_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"billing_type_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"actual_start_date"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"start_date"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"original_start_date"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"actual_completion_date"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"due_date"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"original_due_date"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004101":{"id":2004101,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-1841822228,"x":80,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004160,2004173,2004249],"outputConnectorIDs":[2004181],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"unite client_fee_history"}}}},"visible":true},"2":{"slot":2,"name":"Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"All Columns"}}}},"visible":true},"3":{"slot":3,"name":"Cast Types","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"4":{"slot":4,"name":"Add Source Component Column","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Remove duplicates","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004102":{"id":2004102,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-368,"y":-160,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004172,2004248],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_client_fee_history - fixed resource"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select \n\t\tcfh.id as client_fee_history_id\n\t,\tcfh.client_fee_id\n\t,\tcfh.fee_type_id\n\t,\tcfh.created_on\n\t,\tcfh.bill_date\n\t,\tcfh.amount as fee_amount\n\t,\tcfh.client_id\n\t,\tcfh.resource_id\n\t,\tcfh.status_id\n\t,\tcfh.invoice_id\n\t,\tcfh.invoice_number\n\t,\tcfh.state as client_fee_history_state\n\t,\tcf.frequency\n\t,\tcf.recurring\n    ,\tcf.state as client_fee_state\nfrom exploration.raw_robohead_studios_client_fee_history cfh\n\tinner join exploration.raw_robohead_studios_client_fee cf\n\t\ton cf.id = cfh.client_fee_id\n\t\tand cfh.fee_type_id = 541\n\tleft join reporting.dim_date dd\n    \ton dd.calendar_date = cfh.bill_date::date\nwhere cf.state <> 2 and cfh.state <> 2"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004103":{"id":2004103,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-816,"y":-96,"width":32,"height":32,"inputConnectorIDs":[2004172],"outputConnectorIDs":[2004233],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Monthly Recurring Fees"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"frequency"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"546"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"recurring"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"1"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004104":{"id":2004104,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-816,"y":240,"width":32,"height":32,"inputConnectorIDs":[2004238],"outputConnectorIDs":[2004237],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"filter closed qtr"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"is_qtr_closed"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"true"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004105":{"id":2004105,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":-816,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2004224,2004233,2004247],"outputConnectorIDs":[2004157,2004238],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join dd attr"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Monthly Recurring Fees"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get wes count per month"},"2":{"slot":2,"type":"STRING","value":"mnth"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"Calc closing date"},"2":{"slot":2,"type":"STRING","value":"qtr"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"left(\"rrsph\".\"bill_date\",7)::varchar = \"mnth\".\"fiscal_month\""},"2":{"slot":2,"type":"STRING","value":"rrsph_Left_mnth"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"\"mnth\".\"fiscal_quarter\"=\"qtr\".\"fiscal_quarter\""},"2":{"slot":2,"type":"STRING","value":"rrsph_Left_qtr"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.client_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.client_fee_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.fee_amount"},"2":{"slot":2,"type":"STRING","value":"amount"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.status_id"},"2":{"slot":2,"type":"STRING","value":"status_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.invoice_id"},"2":{"slot":2,"type":"STRING","value":"invoice_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.max_week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"last_wes"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.closing_date"},"2":{"slot":2,"type":"STRING","value":"closing_date"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.is_qtr_closed"},"2":{"slot":2,"type":"STRING","value":"is_qtr_closed"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.count_distinct_week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"no_of_weeks"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"mnth.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"mnth.count_distinct_week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"no_of_wks_month"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.client_fee_history_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_state"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.client_fee_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_state"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.resource_id"},"2":{"slot":2,"type":"STRING","value":"resource_id"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.fee_type_id"},"2":{"slot":2,"type":"STRING","value":"fee_type_id"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"rrsph.bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004106":{"id":2004106,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":1744,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004241],"outputConnectorIDs":[2004200],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"no duplicate employee_sk"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"cw_user_id"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Null"},"4":{"slot":4,"type":"STRING","value":""}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"cw_user_id"},"2":{"slot":2,"type":"STRING","value":"Not"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"2488388"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"OR"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004107":{"id":2004107,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1701703136,"x":-736,"y":160,"width":32,"height":32,"inputConnectorIDs":[2004155],"outputConnectorIDs":[2004225],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get max wes per qtr"}}}},"visible":true},"2":{"slot":2,"name":"Groupings","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}}},"visible":true},"3":{"slot":3,"name":"Aggregations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"Max"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"Count Distinct"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004108":{"id":2004108,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-1841822228,"x":2192,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004171,2004200],"outputConnectorIDs":[2004235],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"union all"}}}},"visible":true},"2":{"slot":2,"name":"Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"All Columns"}}}},"visible":true},"3":{"slot":3,"name":"Cast Types","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"4":{"slot":4,"name":"Add Source Component Column","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Remove duplicates","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004109":{"id":2004109,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":1632,"y":144,"width":32,"height":32,"inputConnectorIDs":[2004236],"outputConnectorIDs":[2004177,2004193],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"duplicate employee_sk"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"cw_user_id"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"2488388"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"OR"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004110":{"id":2004110,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":352,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004186,2004189],"outputConnectorIDs":[2004191],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join - timeslips to fees"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"calc interval"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fees"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join - timeslips"},"2":{"slot":2,"type":"STRING","value":"ts"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"    ts.client_id      = fees.client_id\nand ts.user_id        = fees.resource_id\nand ts.timeslip_date >= fees.bill_interval_start\nand ts.timeslip_date  < fees.bill_interval_end"},"2":{"slot":2,"type":"STRING","value":"fees_Left_ts"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_history_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_state"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_state"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"fees.resource_id"},"2":{"slot":2,"type":"STRING","value":"resource_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"fees.fee_type_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_fee_type_id"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"fees.status_id"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"fees.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"fees.bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"fees.bill_interval_start"},"2":{"slot":2,"type":"STRING","value":"bill_interval_start"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"fees.bill_interval_end"},"2":{"slot":2,"type":"STRING","value":"bill_interval_end"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"fees.invoice_id"},"2":{"slot":2,"type":"STRING","value":"invoice_id"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"fees.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"fees.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"fees.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"ts.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"ts.project_billing_type_id"},"2":{"slot":2,"type":"STRING","value":"project_billing_type_id"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"ts.project_state"},"2":{"slot":2,"type":"STRING","value":"project_state"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"ts.retainers_billed_by_fee"},"2":{"slot":2,"type":"STRING","value":"retainers_billed_by_fee"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"ts.project_pivot_state"},"2":{"slot":2,"type":"STRING","value":"project_pivot_state"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"ts.task_id"},"2":{"slot":2,"type":"STRING","value":"task_id"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"ts.task_state"},"2":{"slot":2,"type":"STRING","value":"task_state"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"ts.timeslip_id"},"2":{"slot":2,"type":"STRING","value":"timeslip_id"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"ts.timeslip_state"},"2":{"slot":2,"type":"STRING","value":"timeslip_state"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"ts.timeslip_date"},"2":{"slot":2,"type":"STRING","value":"timeslip_date"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"ts.timeslip_hours"},"2":{"slot":2,"type":"STRING","value":"timeslip_hours"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"ts.timeslip_pay_rate"},"2":{"slot":2,"type":"STRING","value":"timeslip_pay_rate"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"ts.timesheet_id"},"2":{"slot":2,"type":"STRING","value":"timesheet_id"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"ts.timesheet_status"},"2":{"slot":2,"type":"STRING","value":"timesheet_status"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"ts.timesheet_approval_date"},"2":{"slot":2,"type":"STRING","value":"timesheet_approval_date"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"fees.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"fees.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"fees.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"35":{"slot":35,"values":{"1":{"slot":1,"type":"STRING","value":"fees.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004111":{"id":2004111,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1744268877,"x":2064,"y":144,"width":32,"height":32,"inputConnectorIDs":[2004175],"outputConnectorIDs":[2004171],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dedupe"}}}},"visible":true},"2":{"slot":2,"name":"Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_history_state"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_state"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"client_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"cw_client_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"client_sk"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"market_id"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"market_sk"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"currency_id"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"exchange_rate_id"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"currency_sk"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"resource_id"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_fee_type_id"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"revenue_status"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"frequency"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"bill_interval_start"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"bill_interval_end"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"project_actual_start_date"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"project_start_date"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"project_original_start_date"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"project_actual_completion_date"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"project_due_date"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"project_original_due_date"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"invoice_id"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"invoice_date"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"sum_timeslip_hours"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_history_id_hours"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_history_id_projects"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"project_billing_type_id"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"project_state"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"retainers_billed_by_fee"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"project_pivot_state"}}},"35":{"slot":35,"values":{"1":{"slot":1,"type":"STRING","value":"project_sk"}}},"36":{"slot":36,"values":{"1":{"slot":1,"type":"STRING","value":"cw_user_id"}}},"37":{"slot":37,"values":{"1":{"slot":1,"type":"STRING","value":"employee_sk"}}},"38":{"slot":38,"values":{"1":{"slot":1,"type":"STRING","value":"approval_week_ending_sunday_sk"}}},"39":{"slot":39,"values":{"1":{"slot":1,"type":"STRING","value":"approval_week_ending_sunday"}}},"40":{"slot":40,"values":{"1":{"slot":1,"type":"STRING","value":"source_system_sk"}}},"41":{"slot":41,"values":{"1":{"slot":1,"type":"STRING","value":"source_system_name"}}},"42":{"slot":42,"values":{"1":{"slot":1,"type":"STRING","value":"source_table"}}},"43":{"slot":43,"values":{"1":{"slot":1,"type":"STRING","value":"engagement_id"}}},"44":{"slot":44,"values":{"1":{"slot":1,"type":"STRING","value":"working_week_ending_sunday"}}},"45":{"slot":45,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_id"}}},"46":{"slot":46,"values":{"1":{"slot":1,"type":"STRING","value":"invoice_number"}}},"47":{"slot":47,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_status"}}},"48":{"slot":48,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_status_date"}}},"49":{"slot":49,"values":{"1":{"slot":1,"type":"STRING","value":"working_week_ending_sunday_sk"}}},"50":{"slot":50,"values":{"1":{"slot":1,"type":"STRING","value":"revenue_amount"}}},"51":{"slot":51,"values":{"1":{"slot":1,"type":"STRING","value":"estimated_wip_revenue"}}},"52":{"slot":52,"values":{"1":{"slot":1,"type":"STRING","value":"recurring"}}},"53":{"slot":53,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"}}},"54":{"slot":54,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}},"55":{"slot":55,"values":{"1":{"slot":1,"type":"STRING","value":"fee_amount"}}},"56":{"slot":56,"values":{"1":{"slot":1,"type":"STRING","value":"bill_date"}}},"57":{"slot":57,"values":{"1":{"slot":1,"type":"STRING","value":"order_invoice_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004112":{"id":2004112,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":224,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004164],"outputConnectorIDs":[2004165],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter ts"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"hours"},"2":{"slot":2,"type":"STRING","value":"Not"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"0"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004113":{"id":2004113,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-1841822228,"x":1120,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004174,2004198,2004250],"outputConnectorIDs":[2004152],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"UNION ALL"}}}},"visible":true},"2":{"slot":2,"name":"Method","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"All Columns"}}}},"visible":true},"3":{"slot":3,"name":"Cast Types","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"4":{"slot":4,"name":"Add Source Component Column","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Remove duplicates","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004114":{"id":2004114,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":-608,"y":160,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004155,2004240,2004243],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim date"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"date_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"calendar_date"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004115":{"id":2004115,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1701703136,"x":496,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004191],"outputConnectorIDs":[2004194,2004228],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Aggregate timeslip_hours"}}}},"visible":true},"2":{"slot":2,"name":"Groupings","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_history_state"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_state"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"client_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"resource_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"frequency"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"bill_interval_start"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"bill_interval_end"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"invoice_id"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"revenue_amount"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"project_state"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"retainers_billed_by_fee"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"project_pivot_state"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip_pay_rate"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_id"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"invoice_number"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_status"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"client_fee_fee_type_id"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"project_billing_type_id"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"revenue_status"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"timesheet_approval_date"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"recurring"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"estimated_wip_revenue"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"fee_amount"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"bill_date"}}}},"visible":true},"3":{"slot":3,"name":"Aggregations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"timeslip_hours"},"2":{"slot":2,"type":"STRING","value":"Sum"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004116":{"id":2004116,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-368,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2004170],"outputConnectorIDs":[2004169],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"get invoice details"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select\t\n    \tmax(base.client_fee_history_id)\tas\tclient_fee_history_id\n    ,\tbase.client_fee_id\n    ,\tbase.status_id\n    ,\tbase.fee_type_id\n  \t,\tmax(base.client_id)\tas\tclient_id\n    ,\tbase.amount as fee_amount\n    ,\tmax(base.invoice_id)\tas\tinvoice_id\n    ,\tbase.invoice_number\n    ,\tcase when rcoi.order_invoice_id is not null then base.fiscal_month else null end\tas\tinvoice_month  \t\n    ,\tbase.fiscal_month\n    ,\tbase.fiscal_quarter\n  \t,\trcoi.order_invoice_id\n    ,\tmax(base.client_fee_history_state)\tas\tclient_fee_history_state\n    ,\tmax(base.client_fee_state) as client_fee_state\n    ,\tmax(base.resource_id)\tas\tresource_id\nfrom\t$T{Join future dd attributes} base\n  \t\tleft join exploration.raw_cloudwall_order_invoice rcoi on base.invoice_id = rcoi.order_invoice_id\ngroup by base.client_fee_id, base.invoice_number, base.status_id, base.fee_type_id, base.fiscal_month, base.fiscal_quarter, rcoi.order_invoice_id, base.amount\norder\tby\tbase.client_fee_id, base.invoice_number, base.fiscal_month, base.fiscal_quarter"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004117":{"id":2004117,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1701703136,"x":-608,"y":48,"width":32,"height":32,"inputConnectorIDs":[2004240],"outputConnectorIDs":[2004224,2004239],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Get wes count per month"}}}},"visible":true},"2":{"slot":2,"name":"Groupings","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}}},"visible":true},"3":{"slot":3,"name":"Aggregations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"Count Distinct"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004118":{"id":2004118,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-608,"y":240,"width":32,"height":32,"inputConnectorIDs":[2004237],"outputConnectorIDs":[2004176],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"revenue  & estimated wip calc"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with cte_monthly\nas (\n\tselect\tbase.client_fee_history_id\n\t  \t,\tbase.client_fee_id\n\t  \t,\tbase.invoice_number\n\t  \t,\tbase.fiscal_month\tas\tinvoice_month\n\t  \t,\tcount(base.client_fee_id) over (partition by base.client_fee_id, base.fiscal_quarter) as client_fee_id_count\n\t  \t,\tbase.client_id\n\t  \t,\tbase.amount\tas\tfee_amount  \t\n\t  \t,\tcase when rcoi.order_invoice_id is not null then base.amount else 0 end\tas revenue_amount\n\t  \t,\tcase when rcoi.order_invoice_id is null then base.amount else 0 end\tas estimated_wip_revenue\n\t  \t,\tsum(base.amount) over (partition by base.client_fee_id, base.fiscal_quarter) as total_qtr_revenue\n\t  \t,\tbase.no_of_wks_month as weeks_month\n\t  \t,\tcase\n  \t\t\t\twhen count(base.client_fee_id) over (partition by base.client_fee_id, base.fiscal_quarter) = 3\n  \t\t\t\t\tthen max(base.no_of_weeks)\n\t  \t\t\telse sum(max(base.no_of_wks_month)) over (partition by base.client_fee_id, base.fiscal_quarter)\n  \t\t\tend as total_weeks\n\t  \t,\tbase.fiscal_month\n\t  \t,\tbase.fiscal_quarter\n\t  \t,\tbase.frequency\n\t  \t,\tbase.recurring\n\t  \t,\tbase.client_fee_history_state\n  \t\t,\tbase.client_fee_state\n\t  \t,\tbase.invoice_id\n\t  \t,\tbase.status_id\n\t  \t,\tbase.fee_type_id\n\t  \t,\tbase.resource_id\n\t  \t,\tbase.bill_date\n\t  \t,\tmax(max(base.fiscal_month))\tover\t(partition by base.client_fee_id, base.fiscal_quarter)\tas\tlast_fmonth\n\tfrom\t$T{filter closed qtr}\tbase\n\t  \t\tleft join exploration.raw_cloudwall_order_invoice rcoi on base.invoice_id = rcoi.order_invoice_id\n\tgroup by base.client_fee_history_id, base.client_fee_id, base.invoice_number,base.fiscal_month,base.client_id,base.no_of_wks_month\n  \t\t\t ,base.fiscal_quarter,base.frequency,base.recurring, base.client_fee_history_state, base.client_fee_state, base.invoice_id, base.status_id\n  \t\t\t , base.fee_type_id, base.resource_id, base.bill_date, rcoi.order_invoice_id, base.amount\n)\n\n,cte_weekly\nas (\n\tselect\t*\n\t  \t,\ttotal_qtr_revenue\t/\ttotal_weeks\tas\tweekly_revenue_amount\n\tfrom\tcte_monthly\n)\n\n,cte_excess\nas (\n\tselect\t*\n\t\t,\tweekly_revenue_amount * weeks_month as calc_monthly_revenue_amount\n\t    ,\tcase\n\t    \t\twhen fiscal_month != last_fmonth\n\t    \t\t\tthen fee_amount - (weekly_revenue_amount * weeks_month)\n\t        \telse 0\n\t        end\tas\tfee_excess\n\tfrom\tcte_weekly\n\t\n )\n,cte_excess_2\nas (\n\tselect\t*\n\t    ,\tcase\n\t    \t\twhen fiscal_month != last_fmonth\n\t    \t\t\tthen fee_amount + coalesce(lag(fee_excess,1)over(partition by client_fee_id,fiscal_quarter order by bill_date asc),0) - (weekly_revenue_amount * weeks_month)\n\t        \telse 0\n\t        end\tas\tfee_excess_amount\n\tfrom\tcte_excess\n\t\n )\n\n\nselect \tclient_fee_history_id\n\t,\tclient_fee_id\n\t,\tinvoice_number\n\t,\tinvoice_month\n\t,\tclient_fee_id_count\n\t,\tclient_id\n\t,\tfee_amount  \t\n\t,\trevenue_amount\n\t,\testimated_wip_revenue\n\t,\ttotal_qtr_revenue\n\t,\tweeks_month\n\t,\ttotal_weeks\n\t,\tfiscal_month\n\t,\tfiscal_quarter\n\t,\tfrequency\n\t,\trecurring\n\t,\tclient_fee_history_state\n    ,\tclient_fee_state\n\t,\tinvoice_id\n\t,\tstatus_id\n\t,\tfee_type_id\n\t,\tresource_id\n\t,\tbill_date\n\t,\tlast_fmonth\n    ,\tweekly_revenue_amount\n    ,\tcalc_monthly_revenue_amount\n    ,\tfee_excess_amount\nfrom\tcte_excess_2\norder\tby\tfiscal_month,\tfiscal_quarter,\tclient_fee_history_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004119":{"id":2004119,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":-528,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2004156,2004245],"outputConnectorIDs":[2004170,2004227],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join future dd attributes"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter not closed"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"build future dd attributes"},"2":{"slot":2,"type":"STRING","value":"dd"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"fiscal_month\"=\"dd\".\"fiscal_month\"\nand\n\"rrspfh\".\"fiscal_quarter\"=\"dd\".\"fiscal_quarter\"\n"},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_dd"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.amount"},"2":{"slot":2,"type":"STRING","value":"amount"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.status_id"},"2":{"slot":2,"type":"STRING","value":"status_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_id"},"2":{"slot":2,"type":"STRING","value":"invoice_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.last_wes"},"2":{"slot":2,"type":"STRING","value":"last_wes"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.closing_date"},"2":{"slot":2,"type":"STRING","value":"closing_date"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.is_qtr_closed"},"2":{"slot":2,"type":"STRING","value":"is_qtr_closed"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.no_of_wks_month"},"2":{"slot":2,"type":"STRING","value":"no_of_wks_month"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"dd.month_rank"},"2":{"slot":2,"type":"STRING","value":"month_rank"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"dd.weeks_per_month"},"2":{"slot":2,"type":"STRING","value":"weeks_per_month"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"dd.weeks_per_qtr"},"2":{"slot":2,"type":"STRING","value":"weeks_per_qtr"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"dd.prev_weeks_qtr"},"2":{"slot":2,"type":"STRING","value":"prev_weeks_qtr"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_history_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_state"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_state"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_type_id"},"2":{"slot":2,"type":"STRING","value":"fee_type_id"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.resource_id"},"2":{"slot":2,"type":"STRING","value":"resource_id"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004120":{"id":2004120,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":80,"y":96,"width":32,"height":32,"inputConnectorIDs":[2004180],"outputConnectorIDs":[2004173],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"revenue splits"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"case\n\twhen \"order_invoice_id\" is not null\n    \tthen \"fee_amount\"\n    else 0\nend::numeric(38,4)"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"case\n\twhen \"order_invoice_id\" is null\n    \tthen \"fee_amount\"\n    else 0\nend::numeric(38,4)"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004121":{"id":2004121,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":976,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004185,2004190],"outputConnectorIDs":[2004168,2004244],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"robohead_projects"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"p"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_pivot"},"2":{"slot":2,"type":"STRING","value":"pp"},"3":{"slot":3,"type":"STRING","value":"Inner"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"p.id = pp.id\nand (pp.retainers_billed_by_fee = 'No' or pp.retainers_billed_by_fee is null)"},"2":{"slot":2,"type":"STRING","value":"p_Inner_pp"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"p.id"},"2":{"slot":2,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"p.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"p.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"billing_type_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"p.state"},"2":{"slot":2,"type":"STRING","value":"project_state"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"p.actual_start_date"},"2":{"slot":2,"type":"STRING","value":"actual_start_date"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"p.start_date"},"2":{"slot":2,"type":"STRING","value":"start_date"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"p.original_start_date"},"2":{"slot":2,"type":"STRING","value":"original_start_date"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"p.actual_completion_date"},"2":{"slot":2,"type":"STRING","value":"actual_completion_date"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"p.due_date"},"2":{"slot":2,"type":"STRING","value":"due_date"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"p.original_due_date"},"2":{"slot":2,"type":"STRING","value":"original_due_date"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"pp.retainers_billed_by_fee"},"2":{"slot":2,"type":"STRING","value":"retainers_billed_by_fee"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"pp.state"},"2":{"slot":2,"type":"STRING","value":"project_pivot_state"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004122":{"id":2004122,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":816,"y":112,"width":32,"height":32,"inputConnectorIDs":[2004228],"outputConnectorIDs":[2004184,2004198],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter for fees with timeslip_hours"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"sum_timeslip_hours"},"2":{"slot":2,"type":"STRING","value":"Not"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"0"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004123":{"id":2004123,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":224,"y":432,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004163],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_timesheet"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_timesheet"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"status"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"modified_on"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004124":{"id":2004124,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":976,"y":272,"width":32,"height":32,"inputConnectorIDs":[2004161,2004244],"outputConnectorIDs":[2004174],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join - projects by client_id"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"no prev projects found"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fees"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"robohead_projects"},"2":{"slot":2,"type":"STRING","value":"p"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_id = p.client_id\nand p.billing_type_id = 107\nand p.project_state in (1,2,3)\nand fees.bill_date::date >= coalesce(p.actual_start_date     ,p.start_date,p.original_start_date)::date\nand fees.bill_date::date  < coalesce(p.actual_completion_date,p.due_date  ,p.original_due_date  )::date"},"2":{"slot":2,"type":"STRING","value":"fees_Left_p"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_history_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_state"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_state"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"fees.resource_id"},"2":{"slot":2,"type":"STRING","value":"resource_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_fee_type_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_fee_type_id"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"fees.revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"fees.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"fees.bill_interval_start"},"2":{"slot":2,"type":"STRING","value":"bill_interval_start"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"fees.bill_interval_end"},"2":{"slot":2,"type":"STRING","value":"bill_interval_end"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"fees.invoice_id"},"2":{"slot":2,"type":"STRING","value":"invoice_id"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"fees.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"fees.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"fees.timesheet_id"},"2":{"slot":2,"type":"STRING","value":"timesheet_id"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"fees.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"fees.timesheet_status"},"2":{"slot":2,"type":"STRING","value":"timesheet_status"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"p.id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"p.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"project_billing_type_id"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"p.project_state"},"2":{"slot":2,"type":"STRING","value":"project_state"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"p.retainers_billed_by_fee"},"2":{"slot":2,"type":"STRING","value":"retainers_billed_by_fee"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"p.project_pivot_state"},"2":{"slot":2,"type":"STRING","value":"project_pivot_state"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"fees.sum_timeslip_hours"},"2":{"slot":2,"type":"STRING","value":"sum_timeslip_hours"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"p.actual_start_date"},"2":{"slot":2,"type":"STRING","value":"project_actual_start_date"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"p.start_date"},"2":{"slot":2,"type":"STRING","value":"project_start_date"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"p.original_start_date"},"2":{"slot":2,"type":"STRING","value":"project_original_start_date"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"p.actual_completion_date"},"2":{"slot":2,"type":"STRING","value":"project_actual_completion_date"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"p.due_date"},"2":{"slot":2,"type":"STRING","value":"project_due_date"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"p.original_due_date"},"2":{"slot":2,"type":"STRING","value":"project_original_due_date"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"fees.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"fees.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"fees.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"fees.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"fees.bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004125":{"id":2004125,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1424,"y":320,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004153],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"client_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"source_system_sk"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"source_client_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"current_record_ind"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"client_currency_sk"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004126":{"id":2004126,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":640,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004194],"outputConnectorIDs":[2004179],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter for fees without timeslip_hours"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"sum_timeslip_hours"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Null"},"4":{"slot":4,"type":"STRING","value":""}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"sum_timeslip_hours"},"2":{"slot":2,"type":"STRING","value":"Is"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"0"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"OR"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004127":{"id":2004127,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1344,"y":240,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004196],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_currency"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_currency"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"currency_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"currency_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"exchange_rate_id"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004128":{"id":2004128,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-48,"y":240,"width":32,"height":32,"inputConnectorIDs":[2004162],"outputConnectorIDs":[2004160],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"distribute closed qtr invoice + wip revenue"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with cte_calc_overflows\nas (\n\tselect\tbase.client_fee_history_id\n\t\t,\tbase.client_fee_id\n\t    ,\tbase.client_id\n\t    ,\tbase.invoice_id\n\t    ,\tbase.invoice_number\n\t    ,\tbase.invoice_month\n\t    ,\tbase.fee_amount\n\t    ,\tbase.revenue_amount\n\t    ,\tbase.estimated_wip_revenue\n\t    ,\tbase.weekly_revenue_amount\n\t    ,\tbase.total_qtr_revenue\n\t    ,\tcase\n  \t\t\t\twhen lead(base.bill_date::date, 1) over (partition by base.client_fee_id, base.fiscal_quarter order by base.bill_date::date) is not null\n  \t\t\t\t\tthen lead(base.bill_date::date, 1) over (partition by base.client_fee_id, base.fiscal_quarter order by base.bill_date::date)\n\t  \t\t\telse dateadd('weeks', 1, base.bill_date::date)\n  \t\t\tend\tas bill_date\n\t  \t,\tcase\n  \t\t\t\twhen lead(base.fiscal_month, 1) over (partition by base.client_fee_id, base.fiscal_quarter order by base.bill_date::date) is not null\n  \t\t\t\t\tthen lead(base.fiscal_month, 1) over (partition by base.client_fee_id, base.fiscal_quarter order by base.bill_date::date)\n\t  \t\t\telse rdd.fiscal_month\n  \t\t\tend\tas fiscal_month\n\t  \t,\tcase\n  \t\t\t\twhen lead(base.fiscal_quarter, 1) over (partition by base.client_fee_id, base.fiscal_quarter order by base.bill_date::date) is not null\n\t\t\t\t\tthen lead(base.fiscal_quarter, 1) over (partition by base.client_fee_id, base.fiscal_quarter order by base.bill_date::date)\n\t  \t\t\telse rdd.fiscal_quarter\n\t\t\tend\tas fiscal_quarter\n\t  \t,\tbase.status_id\n\t  \t,\tbase.fee_type_id\n\t  \t,\tbase.frequency\n\t  \t,\tbase.recurring\n\t  \t,\tbase.client_fee_history_state\n  \t\t,\tbase.client_fee_state\n\t  \t,\tbase.resource_id\n\t  \t,\tbase.fee_excess_amount\n\t  \t,\trank() over (partition by base.client_fee_history_id, base.fiscal_month, base.fiscal_quarter order by base.bill_date desc) as rank_num\n\tfrom\t$T{distribute closed revenue}\tbase\n\t  \t\tleft join reporting.dim_date rdd\n  \t\t\t\ton\tdateadd('weeks',1,base.bill_date::date) = rdd.calendar_date\n)\n\n, cte_filter_overflows\nas (\n\tselect\tclient_fee_history_id\n\t\t,\tclient_fee_id\n\t    ,\tclient_id\n\t    ,\tinvoice_id\n\t    ,\tinvoice_number\n\t    ,\tinvoice_month\n\t    ,\tfee_amount\n\t    ,\tcase\n  \t\t\t\twhen invoice_id is not null\n  \t\t\t\t\tthen fee_excess_amount\n  \t\t\t\telse 0\n  \t\t\tend as revenue_amount\n\t    ,\tcase\n  \t\t\t\twhen invoice_id is null\n  \t\t\t\t\tthen fee_excess_amount\n  \t\t\t\telse 0\n  \t\t\tend as estimated_wip_revenue\n\t    ,\ttotal_qtr_revenue\n\t  \t,\tweekly_revenue_amount\n\t  \t,\tbill_date\n\t  \t,\tfiscal_month\n\t  \t,\tfiscal_quarter\n\t  \t,\tstatus_id\n\t  \t,\tfee_type_id\n\t  \t,\tfrequency\n\t  \t,\trecurring\n\t  \t,\tclient_fee_history_state\n  \t\t,\tclient_fee_state\n\t  \t,\tresource_id  \t\n\tfrom\tcte_calc_overflows\n\twhere\trank_num\t=\t1\n  \tand\t\tfee_excess_amount <> 0\n)\n\n, cte_union\nas (\n\tselect\tclient_fee_history_id\n\t     ,\tclient_fee_id\n\t     ,\tclient_id\n\t     ,\tinvoice_id\n\t     ,\tinvoice_number\n\t\t ,\tinvoice_month\n\t     ,\tfee_amount\n\t     ,\trevenue_amount\n\t     ,\testimated_wip_revenue\n\t     ,\ttotal_qtr_revenue\n\t\t ,\tweekly_revenue_amount\n\t\t ,\tbill_date\n\t     ,\tfiscal_month\n\t     ,\tfiscal_quarter\n\t     ,\tstatus_id\n\t     ,\tfee_type_id\n\t     ,\tfrequency\n\t     ,\trecurring\n\t     ,\tclient_fee_history_state\n  \t\t ,\tclient_fee_state\n\t     ,\tresource_id\n\t\t ,\ttrue\tas\tis_overflow\n\tfrom\tcte_filter_overflows\n\tunion\tall\n\tselect\tclient_fee_history_id\n\t     ,\tclient_fee_id\n\t     ,\tclient_id\n\t     ,\tinvoice_id\n\t     ,\tinvoice_number\n\t\t ,\tinvoice_month\n\t     ,\tfee_amount\n\t     ,\tcase\n\t\t\t\t\twhen invoice_id is not null\n\t\t\t\t\t\tthen weekly_revenue_amount\n\t\t\t\t\telse 0\n\t\t\t\tend as revenue_amount\n\t     ,\tcase\n\t\t\t\t\twhen invoice_id is null\n\t\t\t\t\t\tthen weekly_revenue_amount\n\t\t\t\t\telse 0\n\t\t\t\tend as estimated_wip_revenue\n\t     ,\ttotal_qtr_revenue\n\t\t ,\tweekly_revenue_amount\n\t\t ,\tbill_date\n\t     ,\tfiscal_month\n\t     ,\tfiscal_quarter\n\t     ,\tstatus_id\n\t     ,\tfee_type_id\n\t     ,\tfrequency\n\t     ,\trecurring\n\t     ,\tclient_fee_history_state\n  \t\t ,\tclient_fee_state\n\t     ,\tresource_id\n\t\t ,\tfalse\tas\tis_overflow\n\tfrom\t$T{distribute closed revenue}\n  \torder\tby\tbill_date,client_fee_history_id\n)\n\n, cte_flag_overrides\nas (\n\tselect\t*\n\t  \t,\tcase when max(case when is_overflow = true then 1 else 0 end) over (partition by client_fee_id, bill_date, fiscal_month) > 0 then true else false end as is_override\n\tfrom\tcte_union\n\torder\tby\tbill_date,client_fee_history_id\n)\n\n, cte_windowcalc_rows_with_overflows\nas (\n\tselect\tclient_fee_history_id\n\t\t,\tclient_fee_id\n\t\t,\tclient_id\n\t    ,\tinvoice_id\n\t\t,\tinvoice_number\n  \t\t,\tinvoice_month\n\t    ,\tfee_amount\n\t    ,\tcase\n\t\t\t\twhen is_overflow = false and is_override = true and revenue_amount <> 0\n\t  \t\t\t\tthen revenue_amount - (lag(revenue_amount)over(partition by client_fee_id,bill_date order by client_fee_history_id) + lag(estimated_wip_revenue)over(partition by client_fee_id,bill_date order by client_fee_history_id))\n\t  \t\t\telse revenue_amount\n\t  \t\tend as revenue_amount\n\t    ,\tcase\n\t\t\t\twhen is_overflow = false and is_override = true and estimated_wip_revenue <> 0\n\t  \t\t\t\tthen estimated_wip_revenue - (lag(revenue_amount)over(partition by client_fee_id,bill_date order by client_fee_history_id) + lag(estimated_wip_revenue)over(partition by client_fee_id,bill_date order by client_fee_history_id))\n\t  \t\t\telse estimated_wip_revenue\n\t  \t\tend as estimated_wip_revenue\n\t  \t,\ttotal_qtr_revenue\n\t  \t,\tweekly_revenue_amount\n\t    ,\tclient_fee_history_state\n  \t\t,\tclient_fee_state\n\t\t,\tstatus_id\n\t\t,\tfee_type_id\n\t\t,\tresource_id\n\t    ,\tbill_date\n\t    ,\tfiscal_month\n\t    ,\tfiscal_quarter\n\t    ,\tfrequency\n\t\t,\trecurring\n\t  \t,\tis_overflow\n\t  \t,\tis_override\n\tfrom\tcte_flag_overrides  \n\torder by bill_date,client_fee_history_id\n)\n\n\n, cte_src_attributes\nas (\n\tselect\n\t\t\tcfh.client_fee_id\n\t\t,\tcfh.fee_type_id\n\t\t,\tcfh.resource_id\n\t\t,\trank()over(partition by client_fee_id order by cfh.bill_date desc) as rank_num\n\tfrom exploration.raw_robohead_studios_client_fee_history cfh\n\tinner join exploration.raw_robohead_studios_client_fee cf on cf.id = cfh.client_fee_id and cfh.fee_type_id = 541\n\tleft join reporting.dim_date dd on dd.calendar_date = cfh.bill_date::date\n\twhere cf.state <> 2 and cfh.state <> 2\n)\n\n, cte_latest_src_attributes\nas (\n\tselect\n\t\t\tclient_fee_id\n\t\t,\tfee_type_id\n\t\t,\tresource_id\n  \tfrom cte_src_attributes\n  \twhere rank_num = 1\n)\n\n, cte_output\nas (\n\tselect\tcte_fees.client_fee_history_id\n\t\t,\tcte_fees.client_fee_id\n\t\t,\tcte_fees.client_id\n\t    ,\tcte_fees.invoice_id\n\t\t,\tcte_fees.invoice_number\n\t    ,\tcte_fees.invoice_month\n\t    ,\tcte_fees.fee_amount\n\t    ,\tcte_fees.revenue_amount\n\t    ,\tcte_fees.estimated_wip_revenue\n\t    ,\tcte_fees.bill_date\n\t    ,\tcte_fees.fiscal_month\n\t    ,\tcte_fees.fiscal_quarter\n\t\t,\tcte_fees.status_id\n\t\t,\tcoalesce(cte_fees.fee_type_id,cte_attr.fee_type_id) as fee_type_id\n\t    ,\tcte_fees.frequency\n\t\t,\tcte_fees.recurring\n\t    ,\tcte_fees.client_fee_history_state\n  \t\t,\tcte_fees.client_fee_state\n\t\t,\tcoalesce(cte_fees.resource_id,cte_attr.resource_id) as resource_id\n\tfrom\tcte_windowcalc_rows_with_overflows cte_fees\n  \t\tleft join cte_latest_src_attributes cte_attr\n  \t\t\ton cte_fees.client_fee_id = cte_attr.client_fee_id\n)\n\nselect\tclient_fee_history_id\n\t,\tclient_fee_id\n\t,\tclient_id\n    ,\tinvoice_id\n\t,\tinvoice_number\n    ,\tinvoice_month\n    ,\tfee_amount\n    ,\trevenue_amount\n    ,\testimated_wip_revenue\n    ,\tbill_date\n    ,\tfiscal_month\n    ,\tfiscal_quarter\n\t,\tstatus_id\n\t,\tfee_type_id\n    ,\tfrequency\n\t,\trecurring\n    ,\tclient_fee_history_state\n    ,\tclient_fee_state\n\t,\tresource_id\nfrom\tcte_output\norder\tby\tbill_date,client_fee_history_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004129":{"id":2004129,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1701703136,"x":1728,"y":96,"width":32,"height":32,"inputConnectorIDs":[2004177],"outputConnectorIDs":[2004232],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"min/max employee_sk"}}}},"visible":true},"2":{"slot":2,"name":"Groupings","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"cw_user_id"}}}},"visible":true},"3":{"slot":3,"name":"Aggregations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"employee_sk"},"2":{"slot":2,"type":"STRING","value":"Min"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"employee_sk"},"2":{"slot":2,"type":"STRING","value":"Max"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004130":{"id":2004130,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-368,"y":-80,"width":32,"height":32,"inputConnectorIDs":[2004227],"outputConnectorIDs":[2004242],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"client fee unit"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with\tcte_compute_revenue_wip\nas (\n\tselect\tbase.*\n\t  \t,\tcase when rcoi.order_invoice_id is not null then base.amount else 0 end\tas revenue_amount\n\t  \t,\tcase when rcoi.order_invoice_id is null then base.amount else 0 end\tas estimated_wip_revenue\n\t  \t,\trcoi.order_invoice_id\tas\tcw_order_invoice_id\n\tfrom\t$T{Join future dd attributes}\tbase\n\t  \t\tleft join exploration.raw_cloudwall_order_invoice rcoi on base.invoice_id = rcoi.order_invoice_id\n)\n  \n, cte_get_fee_unit\nas (\n\tselect\tbase.client_fee_id\n\t  \t,\tcount(base.client_fee_id) as client_fee_id_count\n\t    ,\tmax(base.client_id)\tas\tclient_id\n\t    ,\tmin(base.month_rank)\tas\tfirst_fmonth\n\t\t,\tmax(base.weeks_per_month)\tas\tweeks_per_month\n\t  \t,\tmax(base.weeks_per_qtr)\tas\tweeks_per_qtr\n\t  \t,\tmax(base.prev_weeks_qtr)\tas\tprev_weeks_qtr\n\t  \t,\tcase when min(base.month_rank) = 1 then max(base.weeks_per_qtr)\n\t  \t\t\t when min(base.month_rank) = 2 then max(base.weeks_per_qtr - base.prev_weeks_qtr)\n\t  \t\telse max(base.weeks_per_month) end\tas\ttotal_weeks\n\t  \t,\tmax(base.amount)\tas\tfee_amount\n\t  \t,\tmax(base.revenue_amount)\tas\trevenue_amount\n\t  \t,\tmax(base.estimated_wip_revenue)\tas\testimated_wip_revenue\n\t  \t,\tmax(base.amount)\t*\t(case when min(month_rank) = 1 then 3 when min(month_rank) = 2 then 2 else 1 end)\tas\ttotal_qtr_revenue\n\t  \t,\t(max(base.amount)\t*\t(case when min(month_rank) = 1 then 3 when min(month_rank) = 2 then 2 else 1 end))\n\t  \t\t/\t(case when min(base.month_rank) = 1 then max(base.weeks_per_qtr)\n\t  \t\t\t      when min(base.month_rank) = 2 then max(base.weeks_per_qtr - base.prev_weeks_qtr)\n\t  \t\t\t else max(base.weeks_per_month) end)\tas\tweekly_revenue_amount\n\t  \t,\tbase.fiscal_quarter\n\tfrom\tcte_compute_revenue_wip\tbase\n\tgroup\tby\tclient_fee_id,\tfiscal_quarter\n\torder\tby\tclient_fee_id,\tfiscal_quarter\n)\n\nselect\t*\nfrom\tcte_get_fee_unit"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004131":{"id":2004131,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-48,"y":160,"width":32,"height":32,"inputConnectorIDs":[2004166],"outputConnectorIDs":[2004249],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"distribute open qtr invoice + wip revenue"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with cte_calculate_new_lines\nas (\n\tselect\tbase.client_fee_history_id\n\t\t,\tbase.client_fee_id\n\t\t,\tbase.client_id\n\t\t,\tbase.invoice_id\n\t\t,\tbase.invoice_number\n  \t\t,\tbase.invoice_month\n\t\t,\tbase.fee_amount\n\t\t,\tbase.revenue_amount\n\t\t,\tbase.estimated_wip_revenue\n\t\t,\tbase.total_qtr_revenue\n\t\t,\tbase.weekly_revenue_amount\n\t\t,\tbase.fee_excess_amount\n\t\t,\tbase.client_fee_history_state\n  \t\t,\tbase.client_fee_state\n\t\t,\tbase.status_id\n\t\t,\tbase.fee_type_id\n\t\t,\tbase.resource_id\n\t\t,\tlead(base.bill_date::date, 1) over (partition by base.client_fee_id, base.fiscal_quarter order by base.bill_date::date)\tas bill_date\n\t\t,\tlead(base.fiscal_month, 1) \t  over (partition by base.client_fee_id, base.fiscal_quarter order by base.bill_date::date) as fiscal_month\n\t\t,\tlead(base.fiscal_quarter, 1)  over (partition by base.client_fee_id, base.fiscal_quarter order by base.bill_date::date) as fiscal_quarter\n\t\t,\tfrequency\n\t\t,\trecurring\n\t\t,\trank() over (partition by base.client_fee_history_id, base.client_fee_id, base.fiscal_month, base.fiscal_quarter order by base.bill_date desc) as rank_num\n\tfrom\t$T{distribute open revenue} base\n)\n\n, cte_get_overflows\nas (\n\tselect\tclient_fee_history_id\n\t\t,\tclient_fee_id\n\t\t,\tclient_id\n\t\t,\tinvoice_id\n\t\t,\tinvoice_number\n  \t\t,\tinvoice_month\n\t\t,\tfee_amount\n\t\t,\tcase when invoice_id is not null then fee_excess_amount else 0 end as revenue_amount\n\t\t,\tcase when invoice_id is null \t then fee_excess_amount else 0 end as estimated_wip_revenue\n\t\t,\ttotal_qtr_revenue\n\t\t,\tweekly_revenue_amount\n\t\t,\tfee_excess_amount\n\t\t,\tclient_fee_history_state\n  \t\t,\tclient_fee_state\n\t\t,\tstatus_id\n\t\t,\tfee_type_id\n\t\t,\tresource_id\n\t\t,\tbill_date\n\t\t,\tfiscal_month\n\t\t,\tfiscal_quarter\n\t\t,\tfrequency\n\t\t,\trecurring\n\tfrom\tcte_calculate_new_lines\n\twhere\trank_num = 1 and bill_date is not null and client_fee_history_id is not null\n)\n\n, cte_union\nas (\n\tselect\tclient_fee_history_id\n\t\t,\tclient_fee_id\n\t\t,\tclient_id\n\t    ,\tinvoice_id\n\t\t,\tinvoice_number\n  \t\t,\tinvoice_month\n\t    ,\tfee_amount\n\t    ,\trevenue_amount\n\t    ,\testimated_wip_revenue\n\t\t,\ttotal_qtr_revenue\n\t    ,\tweekly_revenue_amount\n\t    ,\tclient_fee_history_state\n  \t\t,\tclient_fee_state\n\t\t,\tstatus_id\n\t\t,\tfee_type_id\n\t\t,\tresource_id\n\t    ,\tbill_date\n\t    ,\tfiscal_month\n\t    ,\tfiscal_quarter\n\t    ,\tfrequency\n\t\t,\trecurring\n\t  \t,\ttrue as is_overflow\n\tfrom\tcte_get_overflows\n\tunion\tall\n\tselect\tclient_fee_history_id\n\t\t,\tclient_fee_id\n\t\t,\tclient_id\n\t    ,\tinvoice_id\n\t\t,\tinvoice_number\n  \t\t,\tinvoice_month\n\t    ,\tfee_amount\n\t    ,\tcase when invoice_id is not null then weekly_revenue_amount else 0 end as revenue_amount\n\t    ,\tcase when invoice_id is null then weekly_revenue_amount else 0 end as estimated_wip_revenue\n\t\t,\ttotal_qtr_revenue\n\t  \t,\tweekly_revenue_amount\n\t    ,\tclient_fee_history_state\n  \t\t,\tclient_fee_state\n\t\t,\tstatus_id\n\t\t,\tfee_type_id\n\t\t,\tresource_id\n\t    ,\tbill_date\n\t    ,\tfiscal_month\n\t    ,\tfiscal_quarter\n\t    ,\tfrequency\n\t\t,\trecurring\n\t  \t,\tfalse as is_overflow\n\tfrom\t$T{distribute open revenue}\n\torder\tby\tbill_date\n)\n\n, cte_flag_overrides\nas (\n\tselect\t*\n\t\t,\tcase when max(case when is_overflow = true then 1 else 0 end) over (partition by client_fee_id,\tbill_date, fiscal_month) > 0 then true else false end\tas\tis_override\n\tfrom\tcte_union\n\torder by bill_date\n)\n\n, cte_windowcalc_rows_with_overflows\nas (\n\tselect\tclient_fee_history_id\n\t\t,\tclient_fee_id\n\t\t,\tclient_id\n\t    ,\tinvoice_id\n\t\t,\tinvoice_number\n  \t\t,\tinvoice_month\n\t    ,\tfee_amount\n\t    ,\tcase\n\t\t\t\twhen is_overflow = false and is_override = true and revenue_amount <> 0\n\t  \t\t\t\tthen revenue_amount - (lag(revenue_amount)over(partition by client_fee_id,bill_date order by client_fee_history_id) + lag(estimated_wip_revenue)over(partition by client_fee_id,bill_date order by client_fee_history_id))\n\t  \t\t\telse revenue_amount\n\t  \t\tend as revenue_amount\n\t    ,\tcase\n\t\t\t\twhen is_overflow = false and is_override = true and estimated_wip_revenue <> 0\n\t  \t\t\t\tthen estimated_wip_revenue - (lag(revenue_amount)over(partition by client_fee_id,bill_date order by client_fee_history_id) + lag(estimated_wip_revenue)over(partition by client_fee_id,bill_date order by client_fee_history_id))\n\t  \t\t\telse estimated_wip_revenue\n\t  \t\tend as estimated_wip_revenue\n\t  \t,\ttotal_qtr_revenue\n\t  \t,\tweekly_revenue_amount\n\t    ,\tclient_fee_history_state\n  \t\t,\tclient_fee_state\n\t\t,\tstatus_id\n\t\t,\tfee_type_id\n\t\t,\tresource_id\n\t    ,\tbill_date\n\t    ,\tfiscal_month\n\t    ,\tfiscal_quarter\n\t    ,\tfrequency\n\t\t,\trecurring\n\t  \t,\tis_overflow\n\t  \t,\tis_override\n\tfrom\tcte_flag_overrides  \n\torder by bill_date,client_fee_history_id\n)\n\n, cte_src_attributes\nas (\n\tselect\n\t\t\tcfh.client_fee_id\n\t\t,\tcfh.fee_type_id\n\t\t,\tcfh.resource_id\n\t\t,\trank()over(partition by client_fee_id order by cfh.bill_date desc) as rank_num\n\tfrom exploration.raw_robohead_studios_client_fee_history cfh\n\tinner join exploration.raw_robohead_studios_client_fee cf on cf.id = cfh.client_fee_id and cfh.fee_type_id = 541\n\tleft join reporting.dim_date dd on dd.calendar_date = cfh.bill_date::date\n\twhere cf.state <> 2 and cfh.state <> 2\n)\n\n, cte_latest_src_attributes\nas (\n\tselect\n\t\t\tclient_fee_id\n\t\t,\tfee_type_id\n\t\t,\tresource_id\n  \tfrom cte_src_attributes\n  \twhere rank_num = 1\n)\n\n, cte_output\nas (\n\tselect\tcte_fees.client_fee_history_id\n\t\t,\tcte_fees.client_fee_id\n\t\t,\tcte_fees.client_id\n\t    ,\tcte_fees.invoice_id\n\t\t,\tcte_fees.invoice_number\n\t    ,\tcte_fees.invoice_month\n\t    ,\tcte_fees.fee_amount\n\t    ,\tcte_fees.revenue_amount\n\t    ,\tcte_fees.estimated_wip_revenue\n\t    ,\tcte_fees.bill_date\n\t    ,\tcte_fees.fiscal_month\n\t    ,\tcte_fees.fiscal_quarter\n\t\t,\tcte_fees.status_id\n\t\t,\tcoalesce(cte_fees.fee_type_id,cte_attr.fee_type_id) as fee_type_id\n\t    ,\tcte_fees.frequency\n\t\t,\tcte_fees.recurring\n\t    ,\tcte_fees.client_fee_history_state\n  \t\t,\tcte_fees.client_fee_state\n\t\t,\tcoalesce(cte_fees.resource_id,cte_attr.resource_id) as resource_id\n\tfrom\tcte_windowcalc_rows_with_overflows cte_fees\n  \t\tleft join cte_latest_src_attributes cte_attr\n  \t\t\ton cte_fees.client_fee_id = cte_attr.client_fee_id\n)\n\nselect\tclient_fee_history_id\n\t,\tclient_fee_id\n\t,\tclient_id\n    ,\tinvoice_id\n\t,\tinvoice_number\n    ,\tinvoice_month\n    ,\tfee_amount\n    ,\trevenue_amount\n    ,\testimated_wip_revenue\n    ,\tbill_date\n    ,\tfiscal_month\n    ,\tfiscal_quarter\n\t,\tstatus_id\n\t,\tfee_type_id\n    ,\tfrequency\n\t,\trecurring\n    ,\tclient_fee_history_state\n    ,\tclient_fee_state\n\t,\tresource_id\nfrom\tcte_output\norder\tby\tbill_date,client_fee_history_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004132":{"id":2004132,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":352,"y":368,"width":32,"height":32,"inputConnectorIDs":[2004151,2004163,2004165,2004168],"outputConnectorIDs":[2004186],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join - timeslips"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter ts"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"ts"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_task"},"2":{"slot":2,"type":"STRING","value":"t"},"3":{"slot":3,"type":"STRING","value":"Inner"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"robohead_projects"},"2":{"slot":2,"type":"STRING","value":"p"},"3":{"slot":3,"type":"STRING","value":"Inner"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_timesheet"},"2":{"slot":2,"type":"STRING","value":"tsh"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"t.id = ts.task_id\n"},"2":{"slot":2,"type":"STRING","value":"ts_Inner_t"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"\tp.id = t.project_id\nand p.billing_type_id = 107\nand p.project_state in (1,2,3)\nand (p.retainers_billed_by_fee = 'No' or p.retainers_billed_by_fee is null)"},"2":{"slot":2,"type":"STRING","value":"ts_Inner_p"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"ts.timesheet_id = tsh.id"},"2":{"slot":2,"type":"STRING","value":"ts_Left_tsh"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"p.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"p.billing_type_id"},"2":{"slot":2,"type":"STRING","value":"project_billing_type_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"p.project_state"},"2":{"slot":2,"type":"STRING","value":"project_state"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"ts.task_id"},"2":{"slot":2,"type":"STRING","value":"task_id"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"t.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"t.state"},"2":{"slot":2,"type":"STRING","value":"task_state"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"ts.user_id"},"2":{"slot":2,"type":"STRING","value":"user_id"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"ts.id"},"2":{"slot":2,"type":"STRING","value":"timeslip_id"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"ts.timesheet_id"},"2":{"slot":2,"type":"STRING","value":"timesheet_id"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"tsh.status"},"2":{"slot":2,"type":"STRING","value":"timesheet_status"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"ts.timeslip_date"},"2":{"slot":2,"type":"STRING","value":"timeslip_date"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"ts.hours"},"2":{"slot":2,"type":"STRING","value":"timeslip_hours"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"ts.pay_rate"},"2":{"slot":2,"type":"STRING","value":"timeslip_pay_rate"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"ts.status"},"2":{"slot":2,"type":"STRING","value":"timeslip_status"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"ts.state"},"2":{"slot":2,"type":"STRING","value":"timeslip_state"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"p.retainers_billed_by_fee"},"2":{"slot":2,"type":"STRING","value":"retainers_billed_by_fee"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"p.project_pivot_state"},"2":{"slot":2,"type":"STRING","value":"project_pivot_state"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"tsh.modified_on"},"2":{"slot":2,"type":"STRING","value":"timesheet_approval_date"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004133":{"id":2004133,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":-208,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2004169,2004242,2004246],"outputConnectorIDs":[2004197],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"assign wes"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"client fee unit"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"build future dd attributes"},"2":{"slot":2,"type":"STRING","value":"dd"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"get invoice details"},"2":{"slot":2,"type":"STRING","value":"inv"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"fiscal_quarter\"=\"dd\".\"fiscal_quarter\"\nand\n\"rrspfh\".\"first_fmonth\"<=\"dd\".\"month_rank\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_dd"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"client_id\"=\"inv\".\"client_id\"\nand\n\"rrspfh\".\"client_fee_id\"=\"inv\".\"client_fee_id\"\nand\n\"rrspfh\".\"fiscal_quarter\"=\"inv\".\"fiscal_quarter\"\nand\n\"dd\".\"fiscal_month\"=\"inv\".\"fiscal_month\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_inv"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"inv.client_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"inv.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"inv.invoice_month"},"2":{"slot":2,"type":"STRING","value":"invoice_month"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weekly_revenue_amount"},"2":{"slot":2,"type":"STRING","value":"weekly_revenue_amount"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_qtr_revenue"},"2":{"slot":2,"type":"STRING","value":"total_qtr_revenue"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"dd.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"dd.month_rank"},"2":{"slot":2,"type":"STRING","value":"month_rank"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"dd.weeks_per_month"},"2":{"slot":2,"type":"STRING","value":"weeks_per_month"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"dd.weeks_per_qtr"},"2":{"slot":2,"type":"STRING","value":"weeks_per_qtr"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"dd.prev_weeks_qtr"},"2":{"slot":2,"type":"STRING","value":"prev_weeks_qtr"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"dd.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"dd.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"inv.client_fee_history_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_state"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"inv.client_fee_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_state"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"inv.invoice_id"},"2":{"slot":2,"type":"STRING","value":"invoice_id"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"inv.status_id"},"2":{"slot":2,"type":"STRING","value":"status_id"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"inv.fee_type_id"},"2":{"slot":2,"type":"STRING","value":"fee_type_id"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"inv.resource_id"},"2":{"slot":2,"type":"STRING","value":"resource_id"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"inv.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004134":{"id":2004134,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":1456,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004153,2004167,2004182,2004187,2004188,2004192,2004195,2004196,2004199,2004226,2004231],"outputConnectorIDs":[2004236,2004241],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join - additional columns to fees"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Apportion fees by project"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fees"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_user"},"2":{"slot":2,"type":"STRING","value":"rh_u"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_client"},"2":{"slot":2,"type":"STRING","value":"rh_c"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"raw_cloudwall_order_invoice"},"2":{"slot":2,"type":"STRING","value":"cw_oi"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"dim_source_system"},"2":{"slot":2,"type":"STRING","value":"dss"},"3":{"slot":3,"type":"STRING","value":"Inner"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"dim_project"},"2":{"slot":2,"type":"STRING","value":"dp"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"dim_client"},"2":{"slot":2,"type":"STRING","value":"dc"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"dim_market"},"2":{"slot":2,"type":"STRING","value":"dm"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"dim_currency"},"2":{"slot":2,"type":"STRING","value":"dcu"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"dim_employee"},"2":{"slot":2,"type":"STRING","value":"de"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"},"2":{"slot":2,"type":"STRING","value":"dd1"},"3":{"slot":3,"type":"STRING","value":"Left"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"},"2":{"slot":2,"type":"STRING","value":"dd2"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"fees\".\"resource_id\" = \"rh_u\".\"id\""},"2":{"slot":2,"type":"STRING","value":"fees_Left_rh_u"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"\"fees\".\"client_id\" = \"rh_c\".\"id\""},"2":{"slot":2,"type":"STRING","value":"fees_Left_rh_c"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"\"fees\".\"invoice_id\" = \"cw_oi\".\"order_invoice_id\""},"2":{"slot":2,"type":"STRING","value":"fees_Left_cw_oi"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"\"dss\".\"source_system_name\" = 'robohead'"},"2":{"slot":2,"type":"STRING","value":"fees_Inner_dss"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"    \"fees\".\"project_id\" = \"dp\".\"project_id\"\nand \"dp\".\"source_system_sk\" = \"dss\".\"source_system_sk\"\nand \"dp\".\"current_record_ind\" = true"},"2":{"slot":2,"type":"STRING","value":"fees_Left_dp"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"    \"dc\".\"source_client_id\" = \"fees\".\"client_id\"\n/*and \"dc\".\"market_id\" = \"cw_oi\".\"market_id\" REMOVED BECAUSE DIM_CLIENT HAS ONLY 1 RECORD FOR EACH ROBOHEAD CLIENT*/\nand \"dc\".\"source_system_sk\" = \"dss\".\"source_system_sk\"\nand \"dc\".\"current_record_ind\" = true"},"2":{"slot":2,"type":"STRING","value":"fees_Left_dc"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"\"cw_oi\".\"market_id\" = \"dm\".\"market_id\""},"2":{"slot":2,"type":"STRING","value":"fees_Left_dm"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"\"dc\".\"client_currency_sk\" = \"dcu\".\"currency_sk\""},"2":{"slot":2,"type":"STRING","value":"fees_Left_dcu"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"    \"rh_u\".\"cw_user_id\"   = coalesce(\"de\".\"cloudwall_id\",\"de\".\"cloudwall_talent_id\")\nand de.current_record_ind = true"},"2":{"slot":2,"type":"STRING","value":"fees_Left_de"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"\"fees\".\"bill_date\"::date = \"dd1\".\"calendar_date\""},"2":{"slot":2,"type":"STRING","value":"fees_Left_dd1"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"\"dd1\".\"week_ending_sunday\" = \"dd2\".\"calendar_date\""},"2":{"slot":2,"type":"STRING","value":"fees_Left_dd2"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_history_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_state"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_state"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rh_c.cw_client_id"},"2":{"slot":2,"type":"STRING","value":"cw_client_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"dc.client_sk"},"2":{"slot":2,"type":"STRING","value":"client_sk"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"cw_oi.market_id"},"2":{"slot":2,"type":"STRING","value":"market_id"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"dm.market_sk"},"2":{"slot":2,"type":"STRING","value":"market_sk"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"dcu.currency_id"},"2":{"slot":2,"type":"STRING","value":"currency_id"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"dcu.exchange_rate_id"},"2":{"slot":2,"type":"STRING","value":"exchange_rate_id"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"dcu.currency_sk"},"2":{"slot":2,"type":"STRING","value":"currency_sk"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"fees.resource_id"},"2":{"slot":2,"type":"STRING","value":"resource_id"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_fee_type_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_fee_type_id"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"fees.revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"fees.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"fees.bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"fees.bill_interval_start"},"2":{"slot":2,"type":"STRING","value":"bill_interval_start"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"fees.bill_interval_end"},"2":{"slot":2,"type":"STRING","value":"bill_interval_end"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"fees.project_actual_start_date"},"2":{"slot":2,"type":"STRING","value":"project_actual_start_date"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"fees.project_start_date"},"2":{"slot":2,"type":"STRING","value":"project_start_date"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"fees.project_original_start_date"},"2":{"slot":2,"type":"STRING","value":"project_original_start_date"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"fees.project_actual_completion_date"},"2":{"slot":2,"type":"STRING","value":"project_actual_completion_date"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"fees.project_due_date"},"2":{"slot":2,"type":"STRING","value":"project_due_date"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"fees.project_original_due_date"},"2":{"slot":2,"type":"STRING","value":"project_original_due_date"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"fees.invoice_id"},"2":{"slot":2,"type":"STRING","value":"invoice_id"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"cw_oi.order_invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"fees.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"fees.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"fees.sum_timeslip_hours"},"2":{"slot":2,"type":"STRING","value":"sum_timeslip_hours"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_history_id_hours"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id_hours"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"fees.client_fee_history_id_projects"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id_projects"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"fees.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"fees.project_billing_type_id"},"2":{"slot":2,"type":"STRING","value":"project_billing_type_id"}}},"35":{"slot":35,"values":{"1":{"slot":1,"type":"STRING","value":"fees.project_state"},"2":{"slot":2,"type":"STRING","value":"project_state"}}},"36":{"slot":36,"values":{"1":{"slot":1,"type":"STRING","value":"fees.retainers_billed_by_fee"},"2":{"slot":2,"type":"STRING","value":"retainers_billed_by_fee"}}},"37":{"slot":37,"values":{"1":{"slot":1,"type":"STRING","value":"fees.project_pivot_state"},"2":{"slot":2,"type":"STRING","value":"project_pivot_state"}}},"38":{"slot":38,"values":{"1":{"slot":1,"type":"STRING","value":"dp.project_sk"},"2":{"slot":2,"type":"STRING","value":"project_sk"}}},"39":{"slot":39,"values":{"1":{"slot":1,"type":"STRING","value":"rh_u.cw_user_id"},"2":{"slot":2,"type":"STRING","value":"cw_user_id"}}},"40":{"slot":40,"values":{"1":{"slot":1,"type":"STRING","value":"de.employee_sk"},"2":{"slot":2,"type":"STRING","value":"employee_sk"}}},"41":{"slot":41,"values":{"1":{"slot":1,"type":"STRING","value":"dd2.date_sk"},"2":{"slot":2,"type":"STRING","value":"approval_week_ending_sunday_sk"}}},"42":{"slot":42,"values":{"1":{"slot":1,"type":"STRING","value":"dd1.week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"approval_week_ending_sunday"}}},"43":{"slot":43,"values":{"1":{"slot":1,"type":"STRING","value":"dss.source_system_sk"},"2":{"slot":2,"type":"STRING","value":"source_system_sk"}}},"44":{"slot":44,"values":{"1":{"slot":1,"type":"STRING","value":"dss.source_system_name"},"2":{"slot":2,"type":"STRING","value":"source_system_name"}}},"45":{"slot":45,"values":{"1":{"slot":1,"type":"STRING","value":"fees.source_table"},"2":{"slot":2,"type":"STRING","value":"source_table"}}},"46":{"slot":46,"values":{"1":{"slot":1,"type":"STRING","value":"dp.engagement_id"},"2":{"slot":2,"type":"STRING","value":"engagement_id"}}},"47":{"slot":47,"values":{"1":{"slot":1,"type":"STRING","value":"dd1.week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"working_week_ending_sunday"}}},"48":{"slot":48,"values":{"1":{"slot":1,"type":"STRING","value":"fees.timeslip_pay_rate"},"2":{"slot":2,"type":"STRING","value":"timeslip_pay_rate"}}},"49":{"slot":49,"values":{"1":{"slot":1,"type":"STRING","value":"fees.timesheet_id"},"2":{"slot":2,"type":"STRING","value":"timesheet_id"}}},"50":{"slot":50,"values":{"1":{"slot":1,"type":"STRING","value":"fees.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"51":{"slot":51,"values":{"1":{"slot":1,"type":"STRING","value":"fees.timesheet_status"},"2":{"slot":2,"type":"STRING","value":"timesheet_status"}}},"52":{"slot":52,"values":{"1":{"slot":1,"type":"STRING","value":"fees.timesheet_approval_date"},"2":{"slot":2,"type":"STRING","value":"timesheet_status_date"}}},"53":{"slot":53,"values":{"1":{"slot":1,"type":"STRING","value":"dd2.date_sk"},"2":{"slot":2,"type":"STRING","value":"working_week_ending_sunday_sk"}}},"54":{"slot":54,"values":{"1":{"slot":1,"type":"STRING","value":"fees.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"55":{"slot":55,"values":{"1":{"slot":1,"type":"STRING","value":"fees.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"56":{"slot":56,"values":{"1":{"slot":1,"type":"STRING","value":"fees.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"57":{"slot":57,"values":{"1":{"slot":1,"type":"STRING","value":"fees.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"58":{"slot":58,"values":{"1":{"slot":1,"type":"STRING","value":"cw_oi.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004135":{"id":2004135,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-208,"y":64,"width":32,"height":32,"inputConnectorIDs":[2004197],"outputConnectorIDs":[2004183],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"calc monthly & weekly & excess amounts"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with cte_base_open_qtr\nas (\n\tselect\tclient_fee_history_id\n\t\t,\tclient_fee_id\n\t\t,\tclient_id\n\t\t,\tfiscal_quarter\n\t\t,\tfee_amount\n\t\t,\tcase when invoice_month = fiscal_month then invoice_number else null end as invoice_number\n\t    ,\tinvoice_month\n\t\t,\tcase when order_invoice_id is null then 0 else revenue_amount end as revenue_amount\n\t\t,\tcase when order_invoice_id is null then \n\t  \t\t\t\tcase when nvl(estimated_wip_revenue, 0) = 0 then revenue_amount else estimated_wip_revenue end\n\t  \t\telse 0 end as estimated_wip_revenue\n\t  \t,   total_qtr_revenue\n\t    ,\tweekly_revenue_amount\n\t\t,\tfiscal_month\n\t\t,\tmonth_rank\n\t\t,\tweeks_per_month\n\t\t,\tweeks_per_qtr\n\t\t,\tprev_weeks_qtr\n\t\t,\tfrequency\n\t\t,\trecurring\n\t\t,\tclient_fee_history_state\n  \t\t,\tclient_fee_state\n\t\t,\tinvoice_id\n\t  \t,\torder_invoice_id\n\t\t,\tstatus_id\n\t\t,\tfee_type_id\n\t\t,\tresource_id\n\tfrom\t$T{assign wes}\n  ) \n\n, cte_fee_excess_calc_1\nas (\n\tselect\t*\n\t  \t,\tweekly_revenue_amount * weeks_per_month\tas\tcalc_monthly_revenue\n\t  \t,\tcase\n\t  \t\t\twhen abs(fee_amount) > (abs(weekly_revenue_amount) * weeks_per_month)\n\t  \t\t\t\tthen fee_amount - (weekly_revenue_amount * weeks_per_month)\n\t  \t\telse 0 \n\t  \t\tend as fee_excess\n\tfrom\tcte_base_open_qtr\n)\n\n, cte_fee_excess_calc_2\nas (\n\tselect\t*\n  \t\t,\tfee_amount + coalesce(lag(fee_excess, 1) over (partition by client_fee_id,fiscal_quarter order by month_rank),0) - calc_monthly_revenue as calc_fee_excess\n\tfrom\tcte_fee_excess_calc_1\n\n)\n\n, cte_fee_overflow\nas (\n\tselect\t*\n  \t\t,\tcase\n  \t\t\t\twhen abs(fee_amount + coalesce(lag(calc_fee_excess, 1) over (partition by client_fee_id,fiscal_quarter order by month_rank),0) - calc_monthly_revenue) > 1\n  \t\t\t\t\tthen fee_amount + coalesce(lag(calc_fee_excess, 1) over (partition by client_fee_id,fiscal_quarter order by month_rank),0) - calc_monthly_revenue\n  \t\t\t\telse 0\n  \t\t\tend as fee_excess_amount\n\tfrom\tcte_fee_excess_calc_2\n\n)\n\nselect\n\t\tclient_fee_history_id\n\t,\tclient_fee_id\n\t,\tclient_id\n\t,\tfiscal_quarter\n\t,\tfee_amount\n\t,\tinvoice_number\n\t,\tinvoice_month\n\t,\trevenue_amount\n\t,\testimated_wip_revenue\n\t,   total_qtr_revenue\n\t,\tweekly_revenue_amount\n\t,\tfiscal_month\n\t,\tmonth_rank\n\t,\tweeks_per_month\n\t,\tweeks_per_qtr\n\t,\tprev_weeks_qtr\n\t,\tfrequency\n\t,\trecurring\n\t,\tclient_fee_history_state\n    ,\tclient_fee_state\n\t,\tinvoice_id\n\t,\torder_invoice_id\n\t,\tstatus_id\n\t,\tfee_type_id\n\t,\tresource_id\n    ,\tcalc_monthly_revenue\n    ,\tfee_excess_amount\nfrom\tcte_fee_overflow\norder\tby\tmonth_rank"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004136":{"id":2004136,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":224,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004181],"outputConnectorIDs":[2004189],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"calc interval"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"bill_date::date"},"2":{"slot":2,"type":"STRING","value":"bill_interval_end"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"case\n    when frequency = 545 \n    \tthen dateadd('days',-6,bill_interval_end)\n    when frequency = 546 \n    \tthen dateadd('days',-6,bill_interval_end)\n    when frequency = 547 \n    \tthen dateadd('days',-1,bill_interval_end)\nend::date"},"2":{"slot":2,"type":"STRING","value":"bill_interval_start"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004137":{"id":2004137,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1056,"y":480,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004185],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_pivot"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_project_pivot"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"retainers_billed_by_fee"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004138":{"id":2004138,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":-368,"y":48,"width":32,"height":32,"inputConnectorIDs":[2004239],"outputConnectorIDs":[2004156,2004246],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"build future dd attributes"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"with cte_month_statistics\n    as (select fiscal_month\n             , fiscal_quarter\n             , rank() over (partition by fiscal_quarter order by fiscal_month) as month_rank\n             , count_distinct_week_ending_sunday\tas\tweeks_per_month\n\n             , sum(weeks_per_month) over (partition by fiscal_quarter)\tas\tweeks_per_qtr\n        from $T{Get wes count per month})\n   , cte_additional_month_stats\n    as (select *\n             , case when month_rank != 1 then lag(weeks_per_month, 1) over (order by fiscal_month, fiscal_quarter) else 0 end   as  prev_weeks_qtr\n        from cte_month_statistics)\nselect *\n\t,\t546\tas\tfrequency\n    ,\t1\tas\trecurring\nfrom cte_additional_month_stats\norder by fiscal_month"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004139":{"id":2004139,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1536,"y":80,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004192],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_user"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_user"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"cw_user_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004140":{"id":2004140,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":-736,"y":64,"width":32,"height":32,"inputConnectorIDs":[2004225],"outputConnectorIDs":[2004247],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calc closing date"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"DATEADD ( day, 15, \"max_week_ending_sunday\" )"},"2":{"slot":2,"type":"STRING","value":"closing_date"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"case when sysdate::date >= DATEADD ( day, 15, \"max_week_ending_sunday\" ) then true else false end"},"2":{"slot":2,"type":"STRING","value":"is_qtr_closed"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004141":{"id":2004141,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":-656,"y":-16,"width":32,"height":32,"inputConnectorIDs":[2004157],"outputConnectorIDs":[2004245],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Filter not closed"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"is_qtr_closed"},"2":{"slot":2,"type":"STRING","value":"Not"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"true"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004142":{"id":2004142,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1744268877,"x":-368,"y":160,"width":32,"height":32,"inputConnectorIDs":[2004243],"outputConnectorIDs":[2004229,2004234],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Distinct WES / month"}}}},"visible":true},"2":{"slot":2,"name":"Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_quarter"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004143":{"id":2004143,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":-208,"y":160,"width":32,"height":32,"inputConnectorIDs":[2004183,2004229],"outputConnectorIDs":[2004166],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"distribute open revenue"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"calc monthly & weekly & excess amounts"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Distinct WES / month"},"2":{"slot":2,"type":"STRING","value":"qtr"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"fiscal_quarter\"=\"qtr\".\"fiscal_quarter\"\nand\n\"rrspfh\".\"fiscal_month\"=\"qtr\".\"fiscal_month\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_qtr"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"qtr.week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_qtr_revenue"},"2":{"slot":2,"type":"STRING","value":"total_qtr_revenue"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weekly_revenue_amount"},"2":{"slot":2,"type":"STRING","value":"weekly_revenue_amount"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_excess_amount"},"2":{"slot":2,"type":"STRING","value":"fee_excess_amount"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_history_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_state"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_state"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_id"},"2":{"slot":2,"type":"STRING","value":"invoice_id"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.status_id"},"2":{"slot":2,"type":"STRING","value":"status_id"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_type_id"},"2":{"slot":2,"type":"STRING","value":"fee_type_id"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.resource_id"},"2":{"slot":2,"type":"STRING","value":"resource_id"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_month"},"2":{"slot":2,"type":"STRING","value":"invoice_month"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004144":{"id":2004144,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1408,"y":256,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004195],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"date_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"calendar_date"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"week_ending_sunday"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004145":{"id":2004145,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":-368,"y":240,"width":32,"height":32,"inputConnectorIDs":[2004176,2004234],"outputConnectorIDs":[2004162],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"distribute closed revenue"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"revenue  & estimated wip calc"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Distinct WES / month"},"2":{"slot":2,"type":"STRING","value":"mnth"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"rrspfh\".\"fiscal_quarter\"=\"mnth\".\"fiscal_quarter\"\nand\n\"rrspfh\".\"fiscal_month\"=\"mnth\".\"fiscal_month\""},"2":{"slot":2,"type":"STRING","value":"rrspfh_Left_mnth"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"mnth.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"mnth.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_month"},"2":{"slot":2,"type":"STRING","value":"invoice_month"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"mnth.week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.weekly_revenue_amount"},"2":{"slot":2,"type":"STRING","value":"weekly_revenue_amount"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.calc_monthly_revenue_amount"},"2":{"slot":2,"type":"STRING","value":"calc_monthly_revenue_amount"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.total_qtr_revenue"},"2":{"slot":2,"type":"STRING","value":"total_qtr_revenue"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_excess_amount"},"2":{"slot":2,"type":"STRING","value":"fee_excess_amount"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_history_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_state"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.client_fee_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_state"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.invoice_id"},"2":{"slot":2,"type":"STRING","value":"invoice_id"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.status_id"},"2":{"slot":2,"type":"STRING","value":"status_id"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.fee_type_id"},"2":{"slot":2,"type":"STRING","value":"fee_type_id"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"rrspfh.resource_id"},"2":{"slot":2,"type":"STRING","value":"resource_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004146":{"id":2004146,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1456,"y":16,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004182],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_cloudwall_order_invoice"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_cloudwall_order_invoice"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"order_invoice_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"order_invoice_date"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"market_id"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004147":{"id":2004147,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1488,"y":320,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004231],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_project"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_project"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"project_sk"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"project_id"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"current_record_ind"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"source_system_sk"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"engagement_id"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004148":{"id":2004148,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":1232,"y":192,"width":32,"height":32,"inputConnectorIDs":[2004152],"outputConnectorIDs":[2004226],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Apportion fees by project"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"case\n\n\twhen (\"sum_timeslip_hours\" is null or \"sum_timeslip_hours\" = 0)\n\t\tthen COUNT(\"project_id\") OVER (PARTITION BY \n                                       (case \n\t\t\t\t\t\t\t\t\t\t\twhen (\"sum_timeslip_hours\" is null or \"sum_timeslip_hours\" = 0)\n    \t\t\t\t\t\t\t\t\t\t    then coalesce(\"client_fee_history_id\",0)\n                                        end\n                                       ),\"client_fee_id\",\"bill_date\"\n                                      )\n\nend"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id_projects"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"case \n\twhen \"sum_timeslip_hours\" <> 0\n\t\tthen SUM(\"sum_timeslip_hours\") OVER (PARTITION BY\n                                       (case \n\t\t\t\t\t\t\t\t\t\t\twhen \"sum_timeslip_hours\" <> 0\n    \t\t\t\t\t\t\t\t\t\t    then \"client_fee_history_id\"\n                                        end\n                                       ),\"client_fee_id\",\"bill_date\"\n                                      )\nend"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id_hours"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"case \n    when \"client_fee_history_id_hours\" is not null\n    \tthen case\n        \t\t when \"client_fee_history_id_hours\" = 0\n                 \t then \"revenue_amount\"             \t \n                 else (\"sum_timeslip_hours\"::float / \"client_fee_history_id_hours\"::float)::float * \"revenue_amount\"\n             end\n                     \n    when \"client_fee_history_id_projects\" is not null\n    \tthen case \n        \t\t when \"client_fee_history_id_projects\" = 0\n             \t \t then \"revenue_amount\"\n               \t else( \"revenue_amount\" / \"client_fee_history_id_projects\"::float)\n             end \nend::numeric(38,4)"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"case \n    when \"client_fee_history_id_hours\" is not null\n    \tthen case\n        \t\t when \"client_fee_history_id_hours\" = 0\n                 \t then \"estimated_wip_revenue\"\n             \t else (\"sum_timeslip_hours\"::float / \"client_fee_history_id_hours\"::float)::float * \"estimated_wip_revenue\"\n             end\n                     \n    when \"client_fee_history_id_projects\" is not null\n    \tthen case \n        \t\t when \"client_fee_history_id_projects\" = 0\n             \t \t then \"estimated_wip_revenue\"\n               \t else (\"estimated_wip_revenue\" / \"client_fee_history_id_projects\"::float)\n             end \nend::numeric(38,4)\n"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"'client_fee_history_fixed_resource'"},"2":{"slot":2,"type":"STRING","value":"source_table"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004149":{"id":2004149,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":1376,"y":80,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004167],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_client"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"raw_robohead_studios_client"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"state"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"cw_client_id"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"exploration"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004150":{"id":2004150,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":-1760161015,"x":80,"y":-112,"width":32,"height":32,"inputConnectorIDs":[2004248],"outputConnectorIDs":[2004222],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Non-monthly fees"}}}},"visible":true},"2":{"slot":2,"name":"Filter Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"frequency"},"2":{"slot":2,"type":"STRING","value":"Not"},"3":{"slot":3,"type":"STRING","value":"Equal to"},"4":{"slot":4,"type":"STRING","value":"546"}}}},"visible":true},"3":{"slot":3,"name":"Combine Conditions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"AND"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004158":{"id":2004158,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":1824,"y":144,"width":32,"height":32,"inputConnectorIDs":[2004193,2004232],"outputConnectorIDs":[2004230],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join 0"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"duplicate employee_sk"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"a"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"min/max employee_sk"},"2":{"slot":2,"type":"STRING","value":"agg"},"3":{"slot":3,"type":"STRING","value":"Inner"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"a\".\"cw_user_id\" = \"agg\".\"cw_user_id\""},"2":{"slot":2,"type":"STRING","value":"a_Inner_agg"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"a.client_fee_history_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"a.client_fee_history_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_state"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"a.client_fee_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_id"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"a.client_fee_state"},"2":{"slot":2,"type":"STRING","value":"client_fee_state"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"a.client_id"},"2":{"slot":2,"type":"STRING","value":"client_id"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"a.cw_client_id"},"2":{"slot":2,"type":"STRING","value":"cw_client_id"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"a.client_sk"},"2":{"slot":2,"type":"STRING","value":"client_sk"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"a.market_id"},"2":{"slot":2,"type":"STRING","value":"market_id"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"a.market_sk"},"2":{"slot":2,"type":"STRING","value":"market_sk"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"a.currency_id"},"2":{"slot":2,"type":"STRING","value":"currency_id"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"a.exchange_rate_id"},"2":{"slot":2,"type":"STRING","value":"exchange_rate_id"}}},"12":{"slot":12,"values":{"1":{"slot":1,"type":"STRING","value":"a.currency_sk"},"2":{"slot":2,"type":"STRING","value":"currency_sk"}}},"13":{"slot":13,"values":{"1":{"slot":1,"type":"STRING","value":"a.resource_id"},"2":{"slot":2,"type":"STRING","value":"resource_id"}}},"14":{"slot":14,"values":{"1":{"slot":1,"type":"STRING","value":"a.client_fee_fee_type_id"},"2":{"slot":2,"type":"STRING","value":"client_fee_fee_type_id"}}},"15":{"slot":15,"values":{"1":{"slot":1,"type":"STRING","value":"a.revenue_status"},"2":{"slot":2,"type":"STRING","value":"revenue_status"}}},"16":{"slot":16,"values":{"1":{"slot":1,"type":"STRING","value":"a.frequency"},"2":{"slot":2,"type":"STRING","value":"frequency"}}},"17":{"slot":17,"values":{"1":{"slot":1,"type":"STRING","value":"a.bill_date"},"2":{"slot":2,"type":"STRING","value":"bill_date"}}},"18":{"slot":18,"values":{"1":{"slot":1,"type":"STRING","value":"a.bill_interval_start"},"2":{"slot":2,"type":"STRING","value":"bill_interval_start"}}},"19":{"slot":19,"values":{"1":{"slot":1,"type":"STRING","value":"a.bill_interval_end"},"2":{"slot":2,"type":"STRING","value":"bill_interval_end"}}},"20":{"slot":20,"values":{"1":{"slot":1,"type":"STRING","value":"a.project_actual_start_date"},"2":{"slot":2,"type":"STRING","value":"project_actual_start_date"}}},"21":{"slot":21,"values":{"1":{"slot":1,"type":"STRING","value":"a.project_start_date"},"2":{"slot":2,"type":"STRING","value":"project_start_date"}}},"22":{"slot":22,"values":{"1":{"slot":1,"type":"STRING","value":"a.project_original_start_date"},"2":{"slot":2,"type":"STRING","value":"project_original_start_date"}}},"23":{"slot":23,"values":{"1":{"slot":1,"type":"STRING","value":"a.project_actual_completion_date"},"2":{"slot":2,"type":"STRING","value":"project_actual_completion_date"}}},"24":{"slot":24,"values":{"1":{"slot":1,"type":"STRING","value":"a.project_due_date"},"2":{"slot":2,"type":"STRING","value":"project_due_date"}}},"25":{"slot":25,"values":{"1":{"slot":1,"type":"STRING","value":"a.project_original_due_date"},"2":{"slot":2,"type":"STRING","value":"project_original_due_date"}}},"26":{"slot":26,"values":{"1":{"slot":1,"type":"STRING","value":"a.invoice_id"},"2":{"slot":2,"type":"STRING","value":"invoice_id"}}},"27":{"slot":27,"values":{"1":{"slot":1,"type":"STRING","value":"a.invoice_date"},"2":{"slot":2,"type":"STRING","value":"invoice_date"}}},"28":{"slot":28,"values":{"1":{"slot":1,"type":"STRING","value":"a.revenue_amount"},"2":{"slot":2,"type":"STRING","value":"revenue_amount"}}},"29":{"slot":29,"values":{"1":{"slot":1,"type":"STRING","value":"a.estimated_wip_revenue"},"2":{"slot":2,"type":"STRING","value":"estimated_wip_revenue"}}},"30":{"slot":30,"values":{"1":{"slot":1,"type":"STRING","value":"a.sum_timeslip_hours"},"2":{"slot":2,"type":"STRING","value":"sum_timeslip_hours"}}},"31":{"slot":31,"values":{"1":{"slot":1,"type":"STRING","value":"a.client_fee_history_id_hours"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id_hours"}}},"32":{"slot":32,"values":{"1":{"slot":1,"type":"STRING","value":"a.client_fee_history_id_projects"},"2":{"slot":2,"type":"STRING","value":"client_fee_history_id_projects"}}},"33":{"slot":33,"values":{"1":{"slot":1,"type":"STRING","value":"a.project_id"},"2":{"slot":2,"type":"STRING","value":"project_id"}}},"34":{"slot":34,"values":{"1":{"slot":1,"type":"STRING","value":"a.project_billing_type_id"},"2":{"slot":2,"type":"STRING","value":"project_billing_type_id"}}},"35":{"slot":35,"values":{"1":{"slot":1,"type":"STRING","value":"a.project_state"},"2":{"slot":2,"type":"STRING","value":"project_state"}}},"36":{"slot":36,"values":{"1":{"slot":1,"type":"STRING","value":"a.retainers_billed_by_fee"},"2":{"slot":2,"type":"STRING","value":"retainers_billed_by_fee"}}},"37":{"slot":37,"values":{"1":{"slot":1,"type":"STRING","value":"a.project_pivot_state"},"2":{"slot":2,"type":"STRING","value":"project_pivot_state"}}},"38":{"slot":38,"values":{"1":{"slot":1,"type":"STRING","value":"a.project_sk"},"2":{"slot":2,"type":"STRING","value":"project_sk"}}},"39":{"slot":39,"values":{"1":{"slot":1,"type":"STRING","value":"a.cw_user_id"},"2":{"slot":2,"type":"STRING","value":"cw_user_id"}}},"40":{"slot":40,"values":{"1":{"slot":1,"type":"STRING","value":"a.employee_sk"},"2":{"slot":2,"type":"STRING","value":"employee_sk"}}},"41":{"slot":41,"values":{"1":{"slot":1,"type":"STRING","value":"a.approval_week_ending_sunday_sk"},"2":{"slot":2,"type":"STRING","value":"approval_week_ending_sunday_sk"}}},"42":{"slot":42,"values":{"1":{"slot":1,"type":"STRING","value":"a.approval_week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"approval_week_ending_sunday"}}},"43":{"slot":43,"values":{"1":{"slot":1,"type":"STRING","value":"a.source_system_sk"},"2":{"slot":2,"type":"STRING","value":"source_system_sk"}}},"44":{"slot":44,"values":{"1":{"slot":1,"type":"STRING","value":"a.source_system_name"},"2":{"slot":2,"type":"STRING","value":"source_system_name"}}},"45":{"slot":45,"values":{"1":{"slot":1,"type":"STRING","value":"a.source_table"},"2":{"slot":2,"type":"STRING","value":"source_table"}}},"46":{"slot":46,"values":{"1":{"slot":1,"type":"STRING","value":"a.engagement_id"},"2":{"slot":2,"type":"STRING","value":"engagement_id"}}},"47":{"slot":47,"values":{"1":{"slot":1,"type":"STRING","value":"a.working_week_ending_sunday"},"2":{"slot":2,"type":"STRING","value":"working_week_ending_sunday"}}},"48":{"slot":48,"values":{"1":{"slot":1,"type":"STRING","value":"a.timeslip_pay_rate"},"2":{"slot":2,"type":"STRING","value":"timeslip_pay_rate"}}},"49":{"slot":49,"values":{"1":{"slot":1,"type":"STRING","value":"a.timesheet_id"},"2":{"slot":2,"type":"STRING","value":"timesheet_id"}}},"50":{"slot":50,"values":{"1":{"slot":1,"type":"STRING","value":"a.invoice_number"},"2":{"slot":2,"type":"STRING","value":"invoice_number"}}},"51":{"slot":51,"values":{"1":{"slot":1,"type":"STRING","value":"a.timesheet_status"},"2":{"slot":2,"type":"STRING","value":"timesheet_status"}}},"52":{"slot":52,"values":{"1":{"slot":1,"type":"STRING","value":"a.timesheet_status_date"},"2":{"slot":2,"type":"STRING","value":"timesheet_status_date"}}},"53":{"slot":53,"values":{"1":{"slot":1,"type":"STRING","value":"a.working_week_ending_sunday_sk"},"2":{"slot":2,"type":"STRING","value":"working_week_ending_sunday_sk"}}},"54":{"slot":54,"values":{"1":{"slot":1,"type":"STRING","value":"agg.min_employee_sk"},"2":{"slot":2,"type":"STRING","value":"min_employee_sk"}}},"55":{"slot":55,"values":{"1":{"slot":1,"type":"STRING","value":"agg.max_employee_sk"},"2":{"slot":2,"type":"STRING","value":"max_employee_sk"}}},"56":{"slot":56,"values":{"1":{"slot":1,"type":"STRING","value":"a.recurring"},"2":{"slot":2,"type":"STRING","value":"recurring"}}},"57":{"slot":57,"values":{"1":{"slot":1,"type":"STRING","value":"a.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"58":{"slot":58,"values":{"1":{"slot":1,"type":"STRING","value":"a.fiscal_quarter"},"2":{"slot":2,"type":"STRING","value":"fiscal_quarter"}}},"59":{"slot":59,"values":{"1":{"slot":1,"type":"STRING","value":"a.fee_amount"},"2":{"slot":2,"type":"STRING","value":"fee_amount"}}},"60":{"slot":60,"values":{"1":{"slot":1,"type":"STRING","value":"a.order_invoice_id"},"2":{"slot":2,"type":"STRING","value":"order_invoice_id"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004159":{"id":2004159,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":1952,"y":144,"width":32,"height":32,"inputConnectorIDs":[2004230],"outputConnectorIDs":[2004175],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"employee_sk calc"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"case\n\twhen \"cw_user_id\" = 2488388\n    and  \"bill_date\" < '2023-10-02'\n    \tthen \"min_employee_sk\"\n\twhen \"cw_user_id\" = 2488388\n    and  \"bill_date\" >= '2023-10-02'\n    \tthen \"max_employee_sk\"\nend"},"2":{"slot":2,"type":"STRING","value":"employee_sk"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"2004151":{"id":2004151,"sourceID":2004073,"targetID":2004132},"2004152":{"id":2004152,"sourceID":2004113,"targetID":2004148},"2004153":{"id":2004153,"sourceID":2004125,"targetID":2004134},"2004154":{"id":2004154,"sourceID":2004068,"targetID":2004070},"2004155":{"id":2004155,"sourceID":2004114,"targetID":2004107},"2004156":{"id":2004156,"sourceID":2004138,"targetID":2004119},"2004157":{"id":2004157,"sourceID":2004105,"targetID":2004141},"2004160":{"id":2004160,"sourceID":2004128,"targetID":2004101},"2004161":{"id":2004161,"sourceID":2004071,"targetID":2004124},"2004162":{"id":2004162,"sourceID":2004145,"targetID":2004128},"2004163":{"id":2004163,"sourceID":2004123,"targetID":2004132},"2004164":{"id":2004164,"sourceID":2004067,"targetID":2004112},"2004165":{"id":2004165,"sourceID":2004112,"targetID":2004132},"2004166":{"id":2004166,"sourceID":2004143,"targetID":2004131},"2004167":{"id":2004167,"sourceID":2004149,"targetID":2004134},"2004168":{"id":2004168,"sourceID":2004121,"targetID":2004132},"2004169":{"id":2004169,"sourceID":2004116,"targetID":2004133},"2004170":{"id":2004170,"sourceID":2004119,"targetID":2004116},"2004171":{"id":2004171,"sourceID":2004111,"targetID":2004108},"2004172":{"id":2004172,"sourceID":2004102,"targetID":2004103},"2004173":{"id":2004173,"sourceID":2004120,"targetID":2004101},"2004174":{"id":2004174,"sourceID":2004124,"targetID":2004113},"2004175":{"id":2004175,"sourceID":2004159,"targetID":2004111},"2004176":{"id":2004176,"sourceID":2004118,"targetID":2004145},"2004177":{"id":2004177,"sourceID":2004109,"targetID":2004129},"2004178":{"id":2004178,"sourceID":2004068,"targetID":2004071},"2004179":{"id":2004179,"sourceID":2004126,"targetID":2004068},"2004180":{"id":2004180,"sourceID":2004069,"targetID":2004120},"2004181":{"id":2004181,"sourceID":2004101,"targetID":2004136},"2004182":{"id":2004182,"sourceID":2004146,"targetID":2004134},"2004183":{"id":2004183,"sourceID":2004135,"targetID":2004143},"2004184":{"id":2004184,"sourceID":2004122,"targetID":2004068},"2004185":{"id":2004185,"sourceID":2004137,"targetID":2004121},"2004186":{"id":2004186,"sourceID":2004132,"targetID":2004110},"2004187":{"id":2004187,"sourceID":2004065,"targetID":2004134},"2004188":{"id":2004188,"sourceID":2004066,"targetID":2004134},"2004189":{"id":2004189,"sourceID":2004136,"targetID":2004110},"2004190":{"id":2004190,"sourceID":2004075,"targetID":2004121},"2004191":{"id":2004191,"sourceID":2004110,"targetID":2004115},"2004192":{"id":2004192,"sourceID":2004139,"targetID":2004134},"2004193":{"id":2004193,"sourceID":2004109,"targetID":2004158},"2004194":{"id":2004194,"sourceID":2004115,"targetID":2004126},"2004195":{"id":2004195,"sourceID":2004144,"targetID":2004134},"2004196":{"id":2004196,"sourceID":2004127,"targetID":2004134},"2004197":{"id":2004197,"sourceID":2004133,"targetID":2004135},"2004198":{"id":2004198,"sourceID":2004122,"targetID":2004113},"2004199":{"id":2004199,"sourceID":2004064,"targetID":2004134},"2004200":{"id":2004200,"sourceID":2004106,"targetID":2004108},"2004222":{"id":2004222,"sourceID":2004150,"targetID":2004069},"2004224":{"id":2004224,"sourceID":2004117,"targetID":2004105},"2004225":{"id":2004225,"sourceID":2004107,"targetID":2004140},"2004226":{"id":2004226,"sourceID":2004148,"targetID":2004134},"2004227":{"id":2004227,"sourceID":2004119,"targetID":2004130},"2004228":{"id":2004228,"sourceID":2004115,"targetID":2004122},"2004229":{"id":2004229,"sourceID":2004142,"targetID":2004143},"2004230":{"id":2004230,"sourceID":2004158,"targetID":2004159},"2004231":{"id":2004231,"sourceID":2004147,"targetID":2004134},"2004232":{"id":2004232,"sourceID":2004129,"targetID":2004158},"2004233":{"id":2004233,"sourceID":2004103,"targetID":2004105},"2004234":{"id":2004234,"sourceID":2004142,"targetID":2004145},"2004235":{"id":2004235,"sourceID":2004108,"targetID":2004072},"2004236":{"id":2004236,"sourceID":2004134,"targetID":2004109},"2004237":{"id":2004237,"sourceID":2004104,"targetID":2004118},"2004238":{"id":2004238,"sourceID":2004105,"targetID":2004104},"2004239":{"id":2004239,"sourceID":2004117,"targetID":2004138},"2004240":{"id":2004240,"sourceID":2004114,"targetID":2004117},"2004241":{"id":2004241,"sourceID":2004134,"targetID":2004106},"2004242":{"id":2004242,"sourceID":2004130,"targetID":2004133},"2004243":{"id":2004243,"sourceID":2004114,"targetID":2004142},"2004244":{"id":2004244,"sourceID":2004121,"targetID":2004124},"2004245":{"id":2004245,"sourceID":2004141,"targetID":2004119},"2004246":{"id":2004246,"sourceID":2004138,"targetID":2004133},"2004247":{"id":2004247,"sourceID":2004140,"targetID":2004105},"2004248":{"id":2004248,"sourceID":2004102,"targetID":2004150},"2004249":{"id":2004249,"sourceID":2004131,"targetID":2004101},"2004250":{"id":2004250,"sourceID":2004070,"targetID":2004113}},"notes":{"2004074":{"id":2004074,"x":-738,"y":286,"width":250,"height":58,"text":"**ADM-1210:**\n- created new lines for revenue overflows to the next fiscal month.","colour":"e6e63c"},"2004076":{"id":2004076,"x":525,"y":250,"width":208,"height":63,"text":"**attach latest projects to fees**\nfor fees without timeslips, attach project attributes from the latest invoiced fee to apportion the fee across","colour":"e6e63c"},"2004077":{"id":2004077,"x":647,"y":445,"width":226,"height":40,"text":"temporarily added bill date between project start/end date  & state 1,2,3 filters","colour":"e6e63c"},"2004078":{"id":2004078,"x":-132,"y":412,"width":250,"height":58,"text":"was going to filter timeslips by status=509, but no attributable projects were found when joining to project & project_pivot. Instead using all timeslips","colour":"e6e63c"},"2004079":{"id":2004079,"x":760,"y":530,"width":476,"height":252,"text":"-- apportionment validation\n-- job would result in fee duplication if user submitted offsetting time cards for different projects in the same period, but this seems like a highly scenario. below query would identify these\nwith stg as (\n     select client_fee_history_id, sum(app_amount) as amt\n     from staging.stg1_robohead_studios_fact_financial_metrics_client_fees_fixed_resource\n     group by client_fee_history_id\n     )\n,src as (\n    select id,amount::numeric(30,8) as amt\n    from exploration.raw_robohead_studios_client_fee_history\n    where fee_type_id = 541\n      and status_id = 509\n)\nselect *, src.amt-stg.amt as diff\nfrom src\nfull join stg on stg.client_fee_history_id = src.id\nwhere src.amt-stg.amt not between  -1 and 1;","colour":"e6e63c"},"2004080":{"id":2004080,"x":135,"y":476,"width":447,"height":125,"text":"-- granularity validation\n-- forced 1 record per project per user per billing interval by aggregating hours\nselect project_id,client_fee_history_id\nfrom staging.stg1_robohead_studios_fact_financial_metrics_client_fees_fixed_resource\ngroup by project_id,client_fee_history_id\nhaving count(*)>1;","colour":"e6e63c"},"2004081":{"id":2004081,"x":382,"y":337,"width":151,"height":115,"text":"temporarily added state 1,2,3 filter and inner join on task","colour":"e6e63c"}},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"stage1_robohead_studios_fact_financial_metrics_client_fees_fixed_resource_rewrite","description":"","type":"TRANSFORMATION","tag":"4371790e-f788-4344-80c4-b77c446223ce"}}