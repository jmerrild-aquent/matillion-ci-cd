{"job":{"components":{"2004814":{"id":2004814,"inputCardinality":"ONE","outputCardinality":"ZERO","implementationID":335239555,"x":992,"y":272,"width":32,"height":32,"inputConnectorIDs":[2004809],"outputConnectorIDs":[],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"REWRITE stg1_robohead_studios_cost_ratio"}}}},"visible":true},"2":{"slot":2,"name":"Target Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"stg1_robohead_studios_cost_ratio"}}}},"visible":true},"3":{"slot":3,"name":"Table Sort Key","elements":{},"visible":true},"4":{"slot":4,"name":"Table Distribution Style","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Even"}}}},"visible":true},"5":{"slot":5,"name":"Table Distribution Key","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":""}}}},"visible":false},"6":{"slot":6,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"staging"}}}},"visible":true},"7":{"slot":7,"name":"Sort Key Options","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Compound"}}}},"visible":false}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004815":{"id":2004815,"inputCardinality":"ZERO_OR_MANY","outputCardinality":"MANY","implementationID":-1266674941,"x":464,"y":272,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004812],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"vw_trx_file"}}}},"visible":true},"2":{"slot":2,"name":"SQL Query","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"select trx.trans_date\n      ,replace(trx.account_number,'-' || trx.natural_account, '') as cost_center\n      ,case when s.category = 'revenue' then trx.net_amount * -1 else 0 end as net_amount_revenue\n      ,case when s.category = 'cost'    then trx.net_amount      else 0 end as net_amount_cost\nfrom reporting.vw_trx_file trx\ninner join staging.stg1_robohead_studios_gl_accounts s on s.natural_account = trx.natural_account and s.is_active = true   \nwhere business in (41,58)"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004816":{"id":2004816,"inputCardinality":"ZERO","outputCardinality":"MANY","implementationID":1354890871,"x":496,"y":400,"width":32,"height":32,"inputConnectorIDs":[],"outputConnectorIDs":[2004810],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"}}}},"visible":true},"2":{"slot":2,"name":"Table Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"dim_date"}}}},"visible":true},"3":{"slot":3,"name":"Column Names","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"calendar_date"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_year"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month_number"}}}},"visible":true},"4":{"slot":4,"name":"Trim Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"No"}}}},"visible":true},"5":{"slot":5,"name":"Schema","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"reporting"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004817":{"id":2004817,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":560,"y":336,"width":32,"height":32,"inputConnectorIDs":[2004810],"outputConnectorIDs":[2004808],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal period start end"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"min(calendar_date)over(partition by fiscal_month)"},"2":{"slot":2,"type":"STRING","value":"fiscal_month_start"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"max(calendar_date)over(partition by fiscal_month)"},"2":{"slot":2,"type":"STRING","value":"fiscal_month_end"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"min(calendar_date)over(partition by fiscal_year)"},"2":{"slot":2,"type":"STRING","value":"fiscal_year_start"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"max(calendar_date)over(partition by fiscal_year)"},"2":{"slot":2,"type":"STRING","value":"fiscal_year_end"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004818":{"id":2004818,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1701703136,"x":736,"y":272,"width":32,"height":32,"inputConnectorIDs":[2004811],"outputConnectorIDs":[2004813],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Aggregate revenue/cost"}}}},"visible":true},"2":{"slot":2,"name":"Groupings","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_year"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_year_start"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_year_end"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month_number"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month_start"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal_month_end"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"cost_center"}}}},"visible":true},"3":{"slot":3,"name":"Aggregations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"net_amount_revenue"},"2":{"slot":2,"type":"STRING","value":"Sum"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"net_amount_cost"},"2":{"slot":2,"type":"STRING","value":"Sum"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004819":{"id":2004819,"inputCardinality":"ONE","outputCardinality":"MANY","implementationID":1716658327,"x":848,"y":272,"width":32,"height":32,"inputConnectorIDs":[2004813],"outputConnectorIDs":[2004809],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Calc cost ratio"}}}},"visible":true},"2":{"slot":2,"name":"Include Input Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Yes"}}}},"visible":true},"3":{"slot":3,"name":"Calculations","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"case\n    when \"sum_net_amount_revenue\" <> 0\n    \tthen \"sum_net_amount_cost\"::numeric(30,4) / \"sum_net_amount_revenue\"::numeric(30,4) \n    else 0\nend"},"2":{"slot":2,"type":"STRING","value":"cost_ratio"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"case\n\twhen \"sum_net_amount_revenue\" <> 0\n    \tthen (\"sum_net_amount_revenue\"-\"sum_net_amount_cost\")::numeric(30,4) / \"sum_net_amount_revenue\"::numeric(30,4)\n    else 0\nend"},"2":{"slot":2,"type":"STRING","value":"gp_margin"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"},"2004821":{"id":2004821,"inputCardinality":"MANY","outputCardinality":"MANY","implementationID":-629958239,"x":608,"y":272,"width":32,"height":32,"inputConnectorIDs":[2004808,2004812],"outputConnectorIDs":[2004811],"parameters":{"1":{"slot":1,"name":"Name","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"Join - Fiscal Dates"}}}},"visible":true},"2":{"slot":2,"name":"Main Table","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"vw_trx_file"}}}},"visible":true},"3":{"slot":3,"name":"Main Table Alias","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"trx"}}}},"visible":true},"4":{"slot":4,"name":"Joins","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"fiscal period start end"},"2":{"slot":2,"type":"STRING","value":"dd"},"3":{"slot":3,"type":"STRING","value":"Left"}}}},"visible":true},"5":{"slot":5,"name":"Join Expressions","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"\"trx\".\"trans_date\" = \"dd\".\"calendar_date\""},"2":{"slot":2,"type":"STRING","value":"trx_Left_dd"}}}},"visible":true},"6":{"slot":6,"name":"Output Columns","elements":{"1":{"slot":1,"values":{"1":{"slot":1,"type":"STRING","value":"trx.trans_date"},"2":{"slot":2,"type":"STRING","value":"trans_date"}}},"2":{"slot":2,"values":{"1":{"slot":1,"type":"STRING","value":"trx.cost_center"},"2":{"slot":2,"type":"STRING","value":"cost_center"}}},"3":{"slot":3,"values":{"1":{"slot":1,"type":"STRING","value":"trx.net_amount_revenue"},"2":{"slot":2,"type":"STRING","value":"net_amount_revenue"}}},"4":{"slot":4,"values":{"1":{"slot":1,"type":"STRING","value":"trx.net_amount_cost"},"2":{"slot":2,"type":"STRING","value":"net_amount_cost"}}},"5":{"slot":5,"values":{"1":{"slot":1,"type":"STRING","value":"dd.fiscal_year"},"2":{"slot":2,"type":"STRING","value":"fiscal_year"}}},"6":{"slot":6,"values":{"1":{"slot":1,"type":"STRING","value":"dd.fiscal_month"},"2":{"slot":2,"type":"STRING","value":"fiscal_month"}}},"7":{"slot":7,"values":{"1":{"slot":1,"type":"STRING","value":"dd.fiscal_month_number"},"2":{"slot":2,"type":"STRING","value":"fiscal_month_number"}}},"8":{"slot":8,"values":{"1":{"slot":1,"type":"STRING","value":"dd.fiscal_month_start"},"2":{"slot":2,"type":"STRING","value":"fiscal_month_start"}}},"9":{"slot":9,"values":{"1":{"slot":1,"type":"STRING","value":"dd.fiscal_month_end"},"2":{"slot":2,"type":"STRING","value":"fiscal_month_end"}}},"10":{"slot":10,"values":{"1":{"slot":1,"type":"STRING","value":"dd.fiscal_year_start"},"2":{"slot":2,"type":"STRING","value":"fiscal_year_start"}}},"11":{"slot":11,"values":{"1":{"slot":1,"type":"STRING","value":"dd.fiscal_year_end"},"2":{"slot":2,"type":"STRING","value":"fiscal_year_end"}}}},"visible":true}},"exportMappings":{},"expectedFailure":null,"activationStatus":"ENABLED"}},"connectors":{"2004808":{"id":2004808,"sourceID":2004817,"targetID":2004821},"2004809":{"id":2004809,"sourceID":2004819,"targetID":2004814},"2004810":{"id":2004810,"sourceID":2004816,"targetID":2004817},"2004811":{"id":2004811,"sourceID":2004821,"targetID":2004818},"2004812":{"id":2004812,"sourceID":2004815,"targetID":2004821},"2004813":{"id":2004813,"sourceID":2004818,"targetID":2004819}},"notes":{},"noteConnectors":{},"variables":{},"grids":{}},"info":{"name":"stage1_robohead_studios_cost_ratio","description":"","type":"TRANSFORMATION","tag":"9018a30f-556e-4022-a93a-32e15dfdb7b6"}}